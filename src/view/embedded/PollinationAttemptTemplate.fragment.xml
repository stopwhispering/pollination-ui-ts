<core:FragmentDefinition
	xmlns="sap.m"
	xmlns:f="sap.f"
	xmlns:core="sap.ui.core"
	xmlns:custom="pollination.ui.control"
>

        <!-- highlight="{= (${pollinationsModel>pollen_type} === 'fresh' ? 'Success' : 'Information') }" -->
    <f:GridListItem
        class="formatByOngoing ongoingPollinationStatus"
    >
        <f:customData>
            <core:CustomData
                xmlns:core="sap.ui.core"
                key="pollination_status"
                value="{pollinationsModel>pollination_status}"
                writeToDom="true"
            />
            <core:CustomData
                xmlns:core="sap.ui.core"
                key="is_ongoing"
                value="{= ${pollinationsModel>ongoing}.toString() }"
                writeToDom="true"
            />
        </f:customData>
        <VBox class="sapUiSmallMargin">
            <HBox alignItems="Start" justifyContent="SpaceBetween">
                <core:Icon
                    src="sap-icon://color-fill"
                    class="sapUiTinyMarginEnd"
                    color="{
                        path: 'pollinationsModel>label_color_rgb'
                    }"
                    size="3rem"
                    tooltip="{
                        path: 'pollinationsModel>label_color_rgb'
                    }"
                >
                    <core:layoutData>
                        <FlexItemData growFactor="1" />
                    </core:layoutData>
                </core:Icon>
                <!-- <Label
                    text="ðŸ–Œ"
                >
                </Label> -->
                <VBox>
                    <HBox>
                        <GenericTag
                            text="{= (!!${pollinationsModel>pollinated_at} ? ${pollinationsModel>pollinated_at} : 'unknown date') }"
                            design="StatusIconHidden"
                            class="sapUiTinyMarginEnd"
                        />
                        <core:Icon
                            class="sapUiSmallMarginBegin"
                            visible="{= !!${pollinationsModel>ongoing} }"
                            src="sap-icon://edit"
                            press=".onPressEditOngoingPollination"
                        />
                    </HBox>
                    <HBox alignItems="Center"
                            class="sapUiTinyMarginBottom">
                        <ProgressIndicator
                            width="8rem"
                            enabled="{pollinationsModel>ongoing}"
                            displayValue="{pollinationsModel>current_ripening_days} / {pollinationsModel>predicted_ripening_days}"
                            percentValue="{= (${pollinationsModel>current_ripening_days} / ${pollinationsModel>predicted_ripening_days}) * 100 }"
                            visible="{= !!${pollinationsModel>predicted_ripening_days} }"
                            state="{
                                parts: [
                                    'pollinationsModel>current_ripening_days',
                                    'pollinationsModel>predicted_ripening_days'
                                ],
                                formatter: '.formatter.seed_ripening_progress_indicator_state'
                            }"
                        />
                            <!-- visible="{= !!${pollinationsModel>probability_pollination_to_seed} &amp;&amp; 
                                         (${pollinationsModel>probability_pollination_to_seed} >= 0) }" -->
                        <custom:TrafficLight 
                            visible="{= !!${pollinationsModel>probability_pollination_to_seed}}"
                            size="1.6rem" 
                            class="sapUiSmallMarginBegin"
                            value="{pollinationsModel>probability_pollination_to_seed}" 
                            text="{pollinationsModel>probability_pollination_to_seed}%"
                            tooltip="{= ${pollinationsModel>probability_pollination_to_seed}.toString() + '%' }"
                            asc="false"
                            glimit="35" 
                            rlimit="15"/>
                    </HBox>
                </VBox>
                <!-- <FlexBox> -->
                <!-- </FlexBox> -->
            </HBox>
            <HBox>
                <VBox
                    class="sapUiTinyMarginEnd">
                    <custom:HoverImage
                        width="48px"
                        densityAware="true"
                        visible="{= !!${pollinationsModel>seed_capsule_plant_preview_image_id} }"
                        src="{
                            path: 'pollinationsModel>seed_capsule_plant_preview_image_id',
                            formatter: '.formatter.getImageUrlAvatarS'
                        }"
                        class="roundedBorders"
                        plantName="{pollinationsModel>seed_capsule_plant_name}"
                        plantId="{pollinationsModel>seed_capsule_plant_id}"
                        hoverPress=".onHoverPressPreviewImage"
                    />
                    <custom:HoverImage
                        width="48px"
                        densityAware="true"
                        visible="{= !!${pollinationsModel>pollen_donor_plant_preview_image_id} }"
                        src="{
                            path: 'pollinationsModel>pollen_donor_plant_preview_image_id',
                            formatter: '.formatter.getImageUrlAvatarS'
                        }"
                        class="roundedBorders"
                        plantName="{pollinationsModel>pollen_donor_plant_name}"
                        plantId="{pollinationsModel>pollen_donor_plant_id}"
                        hoverPress=".onHoverPressPreviewImage"
                        />
                </VBox>
                <VBox>
                    <FormattedText
                        htmlText="{
                                parts: [
                                    'pollinationsModel>seed_capsule_plant_id',
                                    'pollinationsModel>seed_capsule_plant_name',
                                    'pollinationsModel>pollen_donor_plant_id',
                                    'pollinationsModel>pollen_donor_plant_name'
                                ],
                                formatter: '.formatter.pollinationAttemptFormattedTextHtml'
                            }"
                        class="sapUiTinyMarginBottom"
                    />
                    
                    <HBox wrap="Wrap" alignItems="Center">
                        <!-- number of pollination attempts and successful pollinations (if seed_capsule stage)
                        in attempt stage, show it grey; in seed_capsule stage, show it green unless count of successful pollinations is not set, then show it orange -->
                        <ObjectStatus 
                            visible="{= (!!${pollinationsModel>count_attempted}) }"
                            text="{= !!${pollinationsModel>count_pollinated} ? ${pollinationsModel>count_pollinated} + '/' + ${pollinationsModel>count_attempted} : ${pollinationsModel>count_attempted} }"
                            tooltip="{= ${pollinationsModel>count_attempted} + ' pollination attempt(s)' + 
                                (${pollinationsModel>count_pollinated} ? '\n' + ${pollinationsModel>count_pollinated} + ' successful' : '') }"
                            class="sapUiTinyMarginEnd"
                            inverted="true"
                            icon="sap-icon://begin"
                            state="{= ${pollinationsModel>pollination_status} === 'seed_capsule' 
                            ? (!${pollinationsModel>count_pollinated} ? 'Warning' : 'Success') : 'None' 
                            }"
                        />
                        <GenericTag
                            text="{
                                path: 'pollinationsModel>pollen_type'
                            }"
                            design="StatusIconHidden"
                            status="{= (${pollinationsModel>pollen_type} === 'fresh' ? 'Success' : 'Information') }"
                            class="sapUiTinyMarginEnd"
                        />
                        <GenericTag
                            text="{
                                path: 'pollinationsModel>location_text'
                            }"
                            design="StatusIconHidden"
                            class="sapUiTinyMarginEnd"
                        />
                        <!-- <GenericTag
                            visible="{= (!!${pollinationsModel>count_attempted}) }"
                            text="{pollinationsModel>count_attempted}"
                            tooltip="{pollinationsModel>count_attempted} flower(s)"
                            design="StatusIconHidden"
                            class="sapUiTinyMarginEnd"
                            status="Warning"
                        /> -->
                        <GenericTag
                            text="{pollinationsModel>pollen_quality}"
                            tooltip="Pollen Quality: {pollinationsModel>pollen_quality}"
                            design="StatusIconHidden"
                            class="sapUiTinyMarginEnd"
                            status="{=
                                ${pollinationsModel>pollen_quality} === 'good' ? 'Success' : 'Error'
                            }"
                        />
                    </HBox>
                </VBox>
            </HBox>
        </VBox>
    </f:GridListItem>

</core:FragmentDefinition>