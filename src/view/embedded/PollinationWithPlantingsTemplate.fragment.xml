<core:FragmentDefinition
	xmlns="sap.m"
	xmlns:f="sap.f"
	xmlns:custom="pollination.ui.control"
	xmlns:core="sap.ui.core"
>
	<f:GridListItem highlight="{= (${pollinationsModel>pollen_type} === 'fresh' ? 'Success' : 'Information') }">
		<VBox class="sapUiSmallMargin" >
			<HBox alignItems="Center">
				<core:Icon
					src="sap-icon://color-fill"
					color="{
						path: 'pollinationsModel>label_color_rgb'
					}"
					size="3rem"
					tooltip="{
						path: 'pollinationsModel>label_color_rgb'
					}"
				>
					<core:layoutData>
						<FlexItemData growFactor="1" />
					</core:layoutData>
				</core:Icon>
				<FlexBox>
					<GenericTag
						text="{= (!!${pollinationsModel>pollinated_at} ? ${pollinationsModel>pollinated_at} : 'unknown date') }"
						design="StatusIconHidden"
						class="sapUiTinyMarginEnd"
					/>
				</FlexBox>
				<Button
					icon="sap-icon://edit"
					visible="{= !!${pollinationsModel>ongoing} }"
					type="Transparent"
					press=".onPressEditOngoingPollination"
				/>
			</HBox>
			
			<HBox>
			
                <VBox
                    class="sapUiTinyMarginEnd">
                    <custom:HoverImage
                        width="80px"
                        densityAware="true"
                        visible="{= !!${pollinationsModel>seed_capsule_plant_preview_image_id} }"
                        src="{
                            path: 'pollinationsModel>seed_capsule_plant_preview_image_id',
                            formatter: '.formatter.getImageUrlAvatarL'
                        }"
                        class="roundedBorders"
                        plantName="{pollinationsModel>seed_capsule_plant_name}"
                        plantId="{pollinationsModel>seed_capsule_plant_id}"
                        hoverPress=".onHoverPressPreviewImage"
                    />
                    <custom:HoverImage
                        width="80px"
                        densityAware="true"
                        visible="{= !!${pollinationsModel>pollen_donor_plant_preview_image_id} }"
                        src="{
                            path: 'pollinationsModel>pollen_donor_plant_preview_image_id',
                            formatter: '.formatter.getImageUrlAvatarL'
                        }"
                        class="roundedBorders"
                        plantName="{pollinationsModel>pollen_donor_plant_name}"
                        plantId="{pollinationsModel>pollen_donor_plant_id}"
                        hoverPress=".onHoverPressPreviewImage"
                        />
                </VBox>
			
				<VBox width="14.5rem">
					<FormattedText
						htmlText="&lt;strong&gt;{
							path: 'pollinationsModel>seed_capsule_plant_id'
						}&lt;/strong&gt; 
							{
							path: 'pollinationsModel>seed_capsule_plant_name'
						} &lt;strong&gt;Ã—&lt;/strong&gt; 
							&lt;strong&gt;{
							path: 'pollinationsModel>pollen_donor_plant_id'
						}&lt;/strong&gt; 
							{
							path: 'pollinationsModel>pollen_donor_plant_name'
						}"
						class="sapUiTinyMarginBottom"
					/>
					<Label
						visible="{=
							!!${pollinationsModel>florescence_comment}
						}"
						text="({pollinationsModel>florescence_comment})"
						tooltip="Florescence ID {pollinationsModel>florescence_id} ({pollinationsModel>florescence_comment})"
					/>
					<HBox wrap="Wrap" alignItems="Center">
						<GenericTag
							text="{
								path: 'pollinationsModel>pollen_type'
							}"
							design="StatusIconHidden"
							status="{= (${pollinationsModel>pollen_type} === 'fresh' ? 'Success' : 'Information') }"
							class="sapUiTinyMarginEnd"
						/>
						<GenericTag
							text="{
								path: 'pollinationsModel>location_text'
							}"
							design="StatusIconHidden"
							class="sapUiTinyMarginEnd"
						/>
							<!-- text="{pollinationsModel>count_attempted}" -->
						<!-- <GenericTag
							visible="{= (!!${pollinationsModel>count_attempted}) }"
							text="{= !!${pollinationsModel>count_pollinated} ? ${pollinationsModel>count_pollinated} + '/' + ${pollinationsModel>count_attempted} : ${pollinationsModel>count_attempted} }"
                            
							tooltip="{pollinationsModel>count_attempted} flower(s)"
							design="StatusIconHidden"
							class="sapUiTinyMarginEnd"
							status="Warning"
						/> -->
                        <ObjectStatus 
                            visible="{= (!!${pollinationsModel>count_attempted}) }"
                            text="{= !!${pollinationsModel>count_pollinated} ? ${pollinationsModel>count_pollinated} + '/' + ${pollinationsModel>count_attempted} : ${pollinationsModel>count_attempted} }"
                            tooltip="{= ${pollinationsModel>count_attempted} + ' pollination attempt(s)' + 
                                (${pollinationsModel>count_pollinated} ? '\n' + ${pollinationsModel>count_pollinated} + ' successful' : '') }"
                            class="sapUiTinyMarginEnd"
                            inverted="true"
                            icon="sap-icon://begin"
                            state="{= ${pollinationsModel>pollination_status} === 'seed_capsule' 
                            ? (!${pollinationsModel>count_pollinated} ? 'Warning' : 'Success') : 'None' 
                            }"
                        />						
						<GenericTag
							text="{pollinationsModel>pollen_quality}"
							tooltip="Pollen Quality: {pollinationsModel>pollen_quality}"
							design="StatusIconHidden"
							class="sapUiTinyMarginEnd"
							status="{=
								${pollinationsModel>pollen_quality} === 'good' ? 'Success' : 'Warning'
							}"
						/>
					</HBox>
				</VBox>
			</HBox>
			

			<VBox>
				<HBox
					class="sapUiSmallMarginTop"
					justifyContent="SpaceBetween"
				>
					<Title text="Seed Plantings" />
					<Button
						icon="sap-icon://add"
						tooltip="Add Seed Planting"
						type="Transparent"
						press=".onPressAddSeedPlanting"
					/>
				</HBox>
				<List
					items="{
						path: 'pollinationsModel>seed_plantings/',
						sorter: [{
							path: 'planted_on',
							descending: 'false'
						}, {
							path: 'id',
							descending: 'false'
						}],
						templateShareable: false
					}"
					mode="SingleSelectMaster"
					backgroundDesign="Transparent"
					growing="true"
					growingScrollToLoad="true"
					showNoData="false"
					showSeparators="Inner"
					selectionChange=".onPressUpdateSeedPlanting"
				>
					<CustomListItem class="formatBySeedPlantingStatus">
						<customData>
							<core:CustomData
								xmlns:core="sap.ui.core"
								key="seed_planting_status"
								value="{pollinationsModel>status}"
								writeToDom="true"
							/>
						</customData>

						<VBox>
							<HBox>
								<VBox
									width="11rem"
									class="sapUiTinyMarginBegin"
								>
									<Label
										text="Planted on {pollinationsModel>planted_on}"
										tooltip="Planted on {pollinationsModel>planted_on} (SeedPlanting ID {pollinationsModel>id})"
										class="sapUiTinyMarginBottom"
									/>
									<Label
										text="{pollinationsModel>soil_name}"
										tooltip="{pollinationsModel>soil_name} (Soil ID {pollinationsModel>soil_id})"
										class="sapUiTinyMarginBottom"
									/>

									<Label
										text="Status: {pollinationsModel>status}"
										tooltip="Status: {pollinationsModel>status}"
										design="Bold"
										class="sapUiTinyMarginBottom"
									/>
									<Label
										text="{pollinationsModel>comment}"
										visible="{= !!${pollinationsModel>comment} }"
										tooltip="{pollinationsModel>comment}"
										width="6rem"
									/>

									<VBox visible="{= ${pollinationsModel>status} === 'planted' }">
										<HBox>
										<Label
											text='Pred. Success:'
											class="sapUiTinyMarginEnd"
											vAlign="Middle"
										/>
										<!-- <Label
											text="{= 'Pred. Success: ' + ${pollinationsModel>predicted_germination_probability}.toString() + '%' }"
											tooltip="{= 'Predicted Success: ' + ${pollinationsModel>predicted_germination_probability}.toString() + '%' }"
											wrapping="true"
										/> -->
										<custom:TrafficLight 
											size="1.6rem" 
											value="{pollinationsModel>predicted_germination_probability}" 
											text="{pollinationsModel>predicted_germination_probability}%"
											asc="false"
											glimit="78" 
											rlimit="69"/>
										</HBox>
										<!-- visible="{= !!${pollinationsModel>predicted_germination_days} }" -->
										<ProgressIndicator
											class="sapUiSmallMarginBottom"
											displayValue="{pollinationsModel>current_germination_days} / {pollinationsModel>predicted_germination_days} days"
											percentValue="{= (${pollinationsModel>current_germination_days} / ${pollinationsModel>predicted_germination_days}) * 100 }"
											
											state="{
												parts: [
													'pollinationsModel>current_germination_days',
													'pollinationsModel>predicted_germination_days'
												],
												formatter: '.formatter.germination_progress_indicator_state'
											}"
											tooltip="{= 'Current Days: ' + ${pollinationsModel>current_germination_days}.toString() + ' Days \n' + 
												'Predicted Days: ' + ${pollinationsModel>predicted_germination_days}.toString() + ' Days \n' }"
										/>
									</VBox>
									<VBox visible="{= ${pollinationsModel>status} === 'germinated' }">
										<Label
											text="{= 'Germinated after ' + ${pollinationsModel>germination_days}.toString() + ' days' }"
											wrapping="true"
										/>
									</VBox>
									<VBox visible="{= ${pollinationsModel>status} === 'abandoned' }">
										<Label
											text="{= 'Abandoned after ' + ${pollinationsModel>germination_days}.toString() + ' days' }"
											wrapping="true"
										/>
									</VBox>
								</VBox>
								<VBox class="sapUiTinyMarginBegin">
									<CheckBox
										text="Sterilized"
										tooltip="Sterilized Soil or sterilized seed (e.g. with Chinosol)"
										displayOnly="true"
										selected="{pollinationsModel>sterilized}"
									/>
									<CheckBox
										text="Soaked"
										tooltip="Seed soaked in water"
										displayOnly="true"
										selected="{pollinationsModel>soaked}"
									/>
									<CheckBox
										text="Covered"
										tooltip="Covered"
										displayOnly="true"
										selected="{pollinationsModel>covered}"
									/>
								</VBox>
							</HBox>
							<List
								showNoData="false"
								items="{
									path: 'pollinationsModel>plants',
									templateShareable: false
								}"
								showSeparators="Inner"
								class="sapUiSmallMarginBeginEnd"
							>
								<CustomListItem>
									<GenericTag
										text="{
											parts: ['pollinationsModel>id', 'pollinationsModel>plant_name'],
											formatter: '.formatter.ellipsize'
										}"
										tooltip="{pollinationsModel>id} {pollinationsModel>plant_name}"
										design="StatusIconHidden"
										status="Success"
										class="sapUiTinyMarginEnd"
									/>
								</CustomListItem>
							</List>
						</VBox>
					</CustomListItem>
				</List>
			</VBox>
		</VBox>
	</f:GridListItem>
</core:FragmentDefinition>