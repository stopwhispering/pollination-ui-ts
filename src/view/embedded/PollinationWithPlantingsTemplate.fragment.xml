<core:FragmentDefinition
	xmlns="sap.m"
	xmlns:f="sap.f"
	xmlns:core="sap.ui.core"
>
	<f:GridListItem highlight="{= (${ongoingPollinationsModel>pollen_type} === 'fresh' ? 'Success' : 'Information') }">
		<VBox class="sapUiSmallMargin">
			<HBox alignItems="Center">
				<core:Icon
					src="sap-icon://color-fill"
					color="{
						path: 'ongoingPollinationsModel>label_color_rgb'
					}"
					size="3rem"
					tooltip="{
						path: 'ongoingPollinationsModel>label_color_rgb'
					}"
				>
					<core:layoutData>
						<FlexItemData growFactor="1" />
					</core:layoutData>
				</core:Icon>
				<FlexBox>
					<GenericTag
						text="{= (!!${ongoingPollinationsModel>pollinated_at} ? ${ongoingPollinationsModel>pollinated_at} : 'unknown date') }"
						design="StatusIconHidden"
						class="sapUiTinyMarginEnd"
					/>
				</FlexBox>
				<Button
					icon="sap-icon://edit"
					type="Transparent"
					press=".onPressEditOngoingPollination"
				/>
			</HBox>
			<VBox>
				<FormattedText
					htmlText="&lt;strong&gt;{
						path: 'ongoingPollinationsModel>seed_capsule_plant_id'
					}&lt;/strong&gt; 
						{
						path: 'ongoingPollinationsModel>seed_capsule_plant_name'
					} &lt;strong&gt;â˜“&lt;/strong&gt; 
						&lt;strong&gt;{
						path: 'ongoingPollinationsModel>pollen_donor_plant_id'
					}&lt;/strong&gt; 
						{
						path: 'ongoingPollinationsModel>pollen_donor_plant_name'
					}"
					class="sapUiTinyMarginBottom"
				/>
				<Label
					visible="{=
						!!${ongoingPollinationsModel>florescence_comment}
					}"
					text="{ongoingPollinationsModel>florescence_id} ({ongoingPollinationsModel>florescence_comment})"
					tooltip="{ongoingPollinationsModel>florescence_id} ({ongoingPollinationsModel>florescence_comment})"
				/>
			</VBox>
			<HBox wrap="Wrap">
				<GenericTag
					text="{
						path: 'ongoingPollinationsModel>pollen_type'
					}"
					design="StatusIconHidden"
					status="{= (${ongoingPollinationsModel>pollen_type} === 'fresh' ? 'Success' : 'Information') }"
					class="sapUiTinyMarginEnd"
				/>
				<GenericTag
					text="{
						path: 'ongoingPollinationsModel>location_text'
					}"
					design="StatusIconHidden"
					class="sapUiTinyMarginEnd"
				/>
				<GenericTag
					visible="{= (!!${ongoingPollinationsModel>count_attempted}) }"
					text="{ongoingPollinationsModel>count_attempted}"
					tooltip="{ongoingPollinationsModel>count_attempted} flower(s)"
					design="StatusIconHidden"
					class="sapUiTinyMarginEnd"
					status="Warning"
				/>
				<GenericTag
					text="{ongoingPollinationsModel>pollen_quality}"
					tooltip="Pollen Quality: {ongoingPollinationsModel>pollen_quality}"
					design="StatusIconHidden"
					class="sapUiTinyMarginEnd"
					status="{=
						${ongoingPollinationsModel>pollen_quality} === 'good' ? 'Success' : 'Warning'
					}"
				/>
			</HBox>
			<VBox>
				<HBox
					class="sapUiSmallMarginTop"
					justifyContent="SpaceBetween"
				>
					<Title text="Seed Plantings" />
					<Button
						icon="sap-icon://add"
						tooltip="Add Seed Planting"
						type="Transparent"
						press=".onPressAddSeedPlanting"
					/>
				</HBox>
				<List
					items="{
						path: 'ongoingPollinationsModel>seed_plantings/',
						sorter: [{
							path: 'planted_on',
							descending: 'false'
						}, {
							path: 'id',
							descending: 'false'
						}],
						templateShareable: false
					}"
					mode="SingleSelectMaster"
					backgroundDesign="Transparent"
					growing="true"
					growingScrollToLoad="true"
					showNoData="false"
					showSeparators="Inner"
					selectionChange=".onPressUpdateSeedPlanting"
				>
					<CustomListItem class="formatBySeedPlantingStatus">
						<customData>
							<core:CustomData
								xmlns:core="sap.ui.core"
								key="seed_planting_status"
								value="{ongoingPollinationsModel>status}"
								writeToDom="true"
							/>
						</customData>

						<VBox>
							<HBox>
								<VBox
									width="11rem"
									class="sapUiTinyMarginBegin"
								>
									<Label
										text="Planted on {ongoingPollinationsModel>planted_on}"
										tooltip="Planted on {ongoingPollinationsModel>planted_on} (SeedPlanting ID {ongoingPollinationsModel>id})"
										class="sapUiTinyMarginBottom"
									/>
									<Label
										text="{ongoingPollinationsModel>soil_name}"
										tooltip="{ongoingPollinationsModel>soil_name} (Soil ID {ongoingPollinationsModel>soil_id})"
										class="sapUiTinyMarginBottom"
									/>

									<Label
										text="Status: {ongoingPollinationsModel>status}"
										tooltip="Status: {ongoingPollinationsModel>status}"
										design="Bold"
										class="sapUiTinyMarginBottom"
									/>
									<Label
										text="{ongoingPollinationsModel>comment}"
										visible="{= !!${ongoingPollinationsModel>comment} }"
										tooltip="{ongoingPollinationsModel>comment}"
										width="6rem"
									/>

									<VBox visible="{= ${ongoingPollinationsModel>status} === 'planted' }">
										<Label
											text="{= 'Pred. Success: ' + ${ongoingPollinationsModel>predicted_germination_probability}.toString() + '%' }"
											tooltip="{= 'Predicted Success: ' + ${ongoingPollinationsModel>predicted_germination_probability}.toString() + '%' }"
											wrapping="true"
										/>
										<ProgressIndicator
											class="sapUiSmallMarginBottom"
											displayValue="{ongoingPollinationsModel>current_germination_days} / {ongoingPollinationsModel>predicted_germination_days}"
											percentValue="{= (${ongoingPollinationsModel>current_germination_days} / ${ongoingPollinationsModel>predicted_germination_days}) * 100 }"
											visible="{= !!${ongoingPollinationsModel>predicted_germination_days} }"
											state="{
												parts: [
													'ongoingPollinationsModel>current_germination_days',
													'ongoingPollinationsModel>predicted_germination_days'
												],
												formatter: '.formatter.germination_progress_indicator_state'
											}"
											tooltip="{= 'Current Days: ' + ${ongoingPollinationsModel>current_germination_days}.toString() + ' Days \n' + 
												'Predicted Days: ' + ${ongoingPollinationsModel>predicted_germination_days}.toString() + ' Days \n' }"
										/>
									</VBox>
									<VBox visible="{= ${ongoingPollinationsModel>status} === 'germinated' }">
										<Label
											text="{= 'Germinated after ' + ${ongoingPollinationsModel>germination_days}.toString() + ' days' }"
											wrapping="true"
										/>
									</VBox>
									<VBox visible="{= ${ongoingPollinationsModel>status} === 'abandoned' }">
										<Label
											text="{= 'Abandoned after ' + ${ongoingPollinationsModel>germination_days}.toString() + ' days' }"
											wrapping="true"
										/>
									</VBox>
								</VBox>
								<VBox class="sapUiTinyMarginBegin">
									<CheckBox
										text="Sterilized"
										tooltip="Sterilized Soil or sterilized seed (e.g. with Chinosol)"
										displayOnly="true"
										selected="{ongoingPollinationsModel>sterilized}"
									/>
									<CheckBox
										text="Soaked"
										tooltip="Seed soaked in water"
										displayOnly="true"
										selected="{ongoingPollinationsModel>soaked}"
									/>
									<CheckBox
										text="Covered"
										tooltip="Covered"
										displayOnly="true"
										selected="{ongoingPollinationsModel>covered}"
									/>
								</VBox>
							</HBox>
							<List
								showNoData="false"
								items="{
									path: 'ongoingPollinationsModel>plants',
									templateShareable: false
								}"
								showSeparators="Inner"
								class="sapUiSmallMarginBeginEnd"
							>
								<CustomListItem>
									<GenericTag
										text="{
											parts: ['ongoingPollinationsModel>id', 'ongoingPollinationsModel>plant_name'],
											formatter: '.formatter.ellipsize'
										}"
										tooltip="{ongoingPollinationsModel>id} {ongoingPollinationsModel>plant_name}"
										design="StatusIconHidden"
										status="Success"
										class="sapUiTinyMarginEnd"
									/>
								</CustomListItem>
							</List>
						</VBox>
					</CustomListItem>
				</List>
			</VBox>
		</VBox>
	</f:GridListItem>
</c:FragmentDefinition>