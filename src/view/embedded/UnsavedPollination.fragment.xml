<c:FragmentDefinition
    xmlns="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:c="sap.ui.core"
	xmlns:custom="pollination.ui.control"
>
    <!-- outer alignment: species + controls at top, buttons at bottom -->
    <VBox
        class="sapUiSmallMargin"
        height="94%"
        justifyContent="SpaceBetween"
    >
        <!-- species -->
        <VBox>
            <HBox>
                <VBox
                    class="sapUiTinyMarginEnd">
                    <custom:HoverImage
                        width="80px"
                        densityAware="true"
                        visible="{= !!${newPollinationsModel>seed_capsule_plant_preview_image_id} }"
                        src="{
                            path: 'newPollinationsModel>seed_capsule_plant_preview_image_id',
                            formatter: '.formatter.getImageUrlAvatarL'
                        }"
                        class="roundedBorders"
                        plantName="{newPollinationsModel>seedCapsulePlantName}"
                        plantId="{newPollinationsModel>seed_capsule_plant_id}"
                        hoverPress=".onHoverPressPreviewImage"
                    />
                    <custom:HoverImage
                        width="80px"
                        densityAware="true"
                        visible="{= !!${newPollinationsModel>pollen_donor_plant_preview_image_id} }"
                        src="{
                            path: 'newPollinationsModel>pollen_donor_plant_preview_image_id',
                            formatter: '.formatter.getImageUrlAvatarL'
                        }"
                        class="roundedBorders"
                        plantName="{newPollinationsModel>pollenDonorPlantName}"
                        plantId="{newPollinationsModel>pollen_donor_plant_id}"
                        hoverPress=".onHoverPressPreviewImage"
                    />
                    <!-- <Image
                        width="80px"
                        densityAware="true"
                        visible="{= !!${newPollinationsModel>seed_capsule_plant_preview_image_id} }"
                        src="{
                            path: 'newPollinationsModel>seed_capsule_plant_preview_image_id',
                            formatter: '.formatter.getImageUrlAvatarL'
                        }"
                        class="roundedBorders"
                    /> -->
                </VBox>
                <VBox width="160px">
                    <FormattedText
                        htmlText="{
                            parts: [
                                'newPollinationsModel>seed_capsule_plant_id',
                                'newPollinationsModel>seedCapsulePlantName',
                                'newPollinationsModel>pollen_donor_plant_id',
                                'newPollinationsModel>pollenDonorPlantName'
                            ],
                            formatter: '.formatter.pollinationAttemptFormattedTextHtml'
                        }"
                        class="sapUiTinyMarginBottom"
                    />
                    <HBox justifyContent="SpaceBetween">
                        <Label
                            class="sapUiTinyMarginBottom"
                            visible="{=
                                !!${newPollinationsModel>florescence_comment}
                            }"
                            text="[{newPollinationsModel>florescence_comment}]"
                            tooltip="Florescence ID {newPollinationsModel>florescence_id} ({newPollinationsModel>florescence_comment})"
                            wrapping="true"
                        />
                        <GenericTag
                            class="sapUiTinyMarginBegin"
                            text="{
                                path: 'newPollinationsModel>pollen_type'
                            }"
                            design="StatusIconHidden"
                            status="{= (${newPollinationsModel>pollen_type} === 'fresh' ? 'Success' : 'Information') }"
                        />
                            <!-- status="{= (${newPollinationsModel>pollen_type} === 'fresh' ? 'Success' : 'Information') }" -->
                    </HBox>
                </VBox>
            </HBox>
            <HBox class="sapUiTinyMarginBottom">
                <DateTimePicker
                    width="11rem"
                    displayFormat="yyyy-MM-dd HH:mm"
                    valueFormat="yyyy-MM-dd HH:mm"
                    value="{
                        path: 'newPollinationsModel>pollinated_at'
                    }"
                    placeholder="Enter Date"
                    showCurrentTimeButton="true"
                />
                <!-- todo -->
                <!-- app:inputId="inpHarvestDate" -->
                <Button
                    icon="sap-icon://calendar"
                    type="Transparent"
                    press=".onPressSetNowButton"
                />
            </HBox>
            <HBox justifyContent="SpaceBetween">
                <VBox>
                    <Label
                        text="Flowers"
                        class="sapUiTinyMarginEnd"
                    />
                    <StepInput
                        width="3rem"
                        max="9"
                        min="1"
                        required="true"
                        textAlign="Center"
                        value="{newPollinationsModel>count_attempted}"
                    />
                </VBox>
            <!-- <VBox class="sapUiTinyMarginBottom">
                <HBox
                    alignItems="Center"
                    justifyContent="SpaceBetween"
                > -->
                    <VBox alignItems="Center">
                        <Label
                            text="Pollen Quality"
                            class="sapUiTinyMarginEnd"
                            vAlign="Middle"
                        />
                        <!-- todo newPollinationsModel>pollen_quality currently good/bad, but must be true/false -->
                        <Switch
                            state="{newPollinationsModel>goodPollenQuality}"
                            customTextOn="+"
                            customTextOff="-"
                            tooltip="Pollen Quality: Good / Bad"
                        >
                            <layoutData>
                                <FlexItemData growFactor="1" />
                            </layoutData>
                        </Switch>
                    </VBox>
                    <!-- <GenericTag
                        text="{
                            path: 'newPollinationsModel>pollen_type'
                        }"
                        design="StatusIconHidden"
                        status="{= (${newPollinationsModel>pollen_type} === 'fresh' ? 'Success' : 'Information') }"
                    /> -->
                <!-- </HBox>
            </VBox> -->
            </HBox>
            <HBox
                justifyContent="SpaceBetween"
                alignItems="Center"
                class="sapUiTinyMarginBottom"
            />
            <SegmentedButton
                selectedKey="{
                    path: 'newPollinationsModel>location'
                }"
                class="sapUiTinyMarginBottom"
                width="14rem"
            >
                <items>
                    <SegmentedButtonItem
                        text="{i18n>AppView.Indoor}"
                        key="indoor"
                    />
                    <SegmentedButtonItem
                        text="{i18n>AppView.IndoorLED}"
                        key="indoor_led"
                    />
                    <SegmentedButtonItem
                        text="{i18n>AppView.Outdoor}"
                        key="outdoor"
                    />
                </items>
            </SegmentedButton>
            <HBox>
                <ColorPalette
                    colorSelect=".onColorSelect"
                    colors="{
                        path: 'newPollinationsModel>',
                        formatter: '.getAvailableColorsForUnsavedPollination'
                    }"
                />
                <FlexBox alignItems="Center">
                    <core:Icon
                        src="sap-icon://color-fill"
                        color="{
                            path: 'newPollinationsModel>label_color_rgb'
                        }"
                        size="3rem"
                    >
                        <core:layoutData>
                            <FlexItemData growFactor="1" />
                        </core:layoutData>
                    </core:Icon>
                </FlexBox>
            </HBox>
        </VBox>

        
        <!-- buttons -->
        <HBox
            justifyContent="SpaceBetween"
            alignItems="Center"
            class="sapUiTinyMarginTop"
        >
            <Button
                text="Discard"
                type="Negative"
                press=".onPressDeleteNewPollinationButton"
            />
            
            <custom:TrafficLight 
                visible="{= !!${newPollinationsModel>probability_pollination_to_seed}}"
                size="1.6rem" 
                class="sapUiSmallMarginBegin"
                value="{newPollinationsModel>probability_pollination_to_seed}" 
                text="{newPollinationsModel>probability_pollination_to_seed}%"
                tooltip="{= ${newPollinationsModel>probability_pollination_to_seed}.toString() + '%' }"
                asc="false"
                glimit="35" 
                rlimit="15"/>

            <Button
                enabled="{= !!${newPollinationsModel>label_color_rgb} &amp;&amp;
                    ${newPollinationsModel>label_color_rgb} !== 'transparent'}"
                text="Save"
                type="Emphasized"
                press=".onPressSaveNewPollinationButton"
            />
        </HBox>
    </VBox>
</c:FragmentDefinition>