<mvc:View
	xmlns:mvc="sap.ui.core.mvc"
	xmlns:core="sap.ui.core"
	xmlns="sap.m"
	xmlns:f="sap.f"
	xmlns:card="sap.f.cards"
	xmlns:grid="sap.ui.layout.cssgrid"
	core:require="{
		Helper: 'pollination/ui/util/Helper'
	}"
	controllerName="pollination.ui.controller.App"
	displayBlock="true"
>
	<App>
		<Page>
			<customHeader>
				<f:ShellBar
					title="{i18n>AppView.Intitle}"
					homeIcon="{:= Helper.resolvePath('./img/bee_favicon.svg') }"
				>
					<f:additionalContent>
						<OverflowToolbarButton
							icon="sap-icon://shortcut"
							tooltip="{i18n>AppView.NewFlorescence}"
							press=".onPressAddActiveFlorescence"
						/>
						<OverflowToolbarButton
							icon="sap-icon://fridge"
							tooltip="{i18n>AppView.MaintainPollenContainers}"
							press=".onPressOpenPollenContainersMaintenance"
						/>
						<OverflowToolbarButton
							icon="sap-icon://e-learning"
							tooltip="{i18n>AppView.ReTrainProbabilityModelPollinationToSeed}"
							press=".onPressRetrainProbabilityModelPollinationToSeed"
						/>
					</f:additionalContent>
				</f:ShellBar>
			</customHeader>
			<content>
				<f:DynamicPage>
					<f:content>
						<VBox width="100%">
							<HBox alignItems="Start">
								<ScrollContainer
									height="18rem"
									width="100%"
									vertical="true"
									horizontal="false"
									focusable="true"
								>
									<List
										id="activeFlorescencesList"
										items="{
											path: 'currentFlorescencesModel>/',
											sorter: [{
												path: 'florescence_status',
												descending: false,
												group: '.getFlorescenceStatusGroup'
											}, {
												path: 'first_flower_opening_date',
												descending: true
											}]
										}"
										mode="SingleSelectMaster"
										growing="true"
										growingScrollToLoad="true"
										showNoData="false"
										showSeparators="Inner"
										selectionChange="onSelectionChangedCurrentFlorescence"
										class="sapUiSmallMarginEnd"
									>
										<CustomListItem>
											<HBox>
												<HBox>
													<Text
														text="{currentFlorescencesModel>plant_id}"
														class="sapUiTinyMarginBegin"
														width="1.6rem"
													/>
													<Text
														text="{=
															${currentFlorescencesModel>plant_name} + 
															(!!${currentFlorescencesModel>comment} ? ' [' + ${currentFlorescencesModel>comment} + ']' : '')
														}"
														class="sapUiTinyMarginBegin"
														width="16rem"
													/>
													<Text
														text="â¸™ {currentFlorescencesModel>branches_count}"
														tooltip="{currentFlorescencesModel>branches_count} branch(es)"
														class="sapUiTinyMarginBegin"
														width="1.4rem"
													/>
													<Text
														text="â• {currentFlorescencesModel>flowers_count}"
														tooltip="{currentFlorescencesModel>flowers_count} flowers"
														class="sapUiTinyMarginBegin"
														width="2rem"
													/>
													<FormattedText
														htmlText="{
															parts: ['currentFlorescencesModel>inflorescence_appearance_date', 'currentFlorescencesModel>first_flower_opening_date', 'currentFlorescencesModel>last_flower_closing_date', 'currentFlorescencesModel>florescence_status'],
															formatter: '.formatter.html_for_active_florescence_dates'
														}"
														tooltip="Inflorescence appeared: {currentFlorescencesModel>inflorescence_appearance_date}, First flower opens: {currentFlorescencesModel>first_flower_opening_date}, Last flower closed: {currentFlorescencesModel>last_flower_closing_date}"
														width="3.5rem"
													/>
												</HBox>
												<Button
													class="tinyButton"
													icon="sap-icon://edit"
													type="Transparent"
													press=".onPressEditActiveFlorescence"
												/>
											</HBox>
										</CustomListItem>
									</List>
									<layoutData>
										<FlexItemData growFactor="1"/>
									</layoutData>
								</ScrollContainer>
								<ScrollContainer
									height="18rem"
									width="100%"
									class="sapUiSmallMarginEnd"
									vertical="true"
									horizontal="false"
									focusable="true"
								>
									<List
										id="potentialPollenDonorsList"
										items="{
											path: 'potentialPollenDonorsModel>/',
											sorter: {
												path: 'pollen_type',
												descending: false,
												group: '.getPollenTypeGroup'
											}
										}"
										mode="SingleSelectMaster"
										growing="true"
										growingScrollToLoad="true"
										showNoData="false"
										showSeparators="Inner"
										selectionChange="onSelectionChangedPollenDonor"
									>
										<CustomListItem highlight="{=
											(${potentialPollenDonorsModel>already_ongoing_attempt} ? 'Error' : 'None') 
										}">
											<HBox>
												<!-- <CheckBox selected="{completed}"  /> -->
												<HBox justifyContent="Center">
													<Text
														text="{potentialPollenDonorsModel>plant_id}"
														class="sapUiTinyMarginBegin"
														width="1.6rem"
													/>
													<Text
														text="{potentialPollenDonorsModel>plant_name}"
														class="sapUiTinyMarginBeginEnd"
														width="16rem"
													/>
													<FormattedText
														width="2.5rem"
														htmlText="{
															parts: ['potentialPollenDonorsModel>probability_pollination_to_seed'],
															formatter: '.formatter.html_for_pollination_probability'
														}"
														tooltip="{= ${potentialPollenDonorsModel>probability_pollination_to_seed}.toString() + '%' }"
														class="sapUiTinyMarginBeginEnd"
													/>
													<HBox
														width="4.5rem"
														items="{
															path: 'potentialPollenDonorsModel>pollination_attempts',
															templateShareable: false
														}"
													>
														<CustomListItem>
															<FormattedText
																htmlText="{
																	parts: ['potentialPollenDonorsModel>pollination_status', 'potentialPollenDonorsModel>ongoing', 'potentialPollenDonorsModel>reverse'],
																	formatter: '.formatter.html_for_pollination_status_indicator'
																}"
																tooltip="status: {potentialPollenDonorsModel>pollination_status}, pollinated: {potentialPollenDonorsModel>pollination_at}, harvested: {potentialPollenDonorsModel>harvest_at}, germination rate: {potentialPollenDonorsModel>germination_rate}"
															/>
														</CustomListItem>
													</HBox>
													<!-- visible="{= ${potentialPollenDonorsModel>pollen_type} === 'frozen' }" -->
													<FormattedText
														width="4.5rem"
														htmlText="{
															path: 'potentialPollenDonorsModel>count_stored_pollen_containers',
															formatter: '.formatter.html_for_count_stored_pollen_containers'
														}"
														tooltip="{= ${potentialPollenDonorsModel>count_stored_pollen_containers} +
															' container(s) left' }"
														class="sapUiTinyMarginBeginEnd"
													/>
													<HBox
														width="4.5rem"
														items="{
															path: 'potentialPollenDonorsModel>resulting_plants',
															templateShareable: false
														}"
													>
														<CustomListItem>
															<Label
																text="{= (${potentialPollenDonorsModel>reverse} ? '(ðŸŒ±)' : 'ðŸŒ±' ) }"
																tooltip="{= ${potentialPollenDonorsModel>plant_id} +
																	' '+ ${potentialPollenDonorsModel>plant_name} }"
															/>
														</CustomListItem>
													</HBox>
												</HBox>
											</HBox>
										</CustomListItem>
									</List>
									<layoutData>
										<FlexItemData growFactor="2"/>
									</layoutData>
								</ScrollContainer>
							</HBox>
							<HBox>
								<f:Card
									class="sapUiMediumMargin"
									width="300px"
								>
									<f:header>
										<card:Header
											title="New pollination attempt"
											subtitle="Plant: {newTempPollinationModel>/florescencePlantName}"
											iconSrc="sap-icon://add"
											iconBackgroundColor="Accent5"
										/>
									</f:header>
									<f:content>
										<VBox class="sapUiSmallMargin">
											<VBox class="sapUiTinyMarginBottom">
												<Input
													id="florescencePlantNameInput"
													value="{newTempPollinationModel>/florescencePlantId} {newTempPollinationModel>/florescencePlantName}"
													editable="false"
													tooltip="{newTempPollinationModel>/florescencePlantId} {newTempPollinationModel>/florescencePlantName}"
												/>
												<Input
													id="pollenDonorPlantNameInput"
													value="{newTempPollinationModel>/pollenDonorPlantId} {newTempPollinationModel>/pollenDonorPlantName}"
													editable="false"
													tooltip="{newTempPollinationModel>/pollenDonorPlantId} {newTempPollinationModel>/pollenDonorPlantName}"
												/>
											</VBox>
											<HBox
												justifyContent="SpaceBetween"
												alignItems="Center"
												class="sapUiTinyMarginBottom"
											>
												<DateTimePicker
													width="11rem"
													id="newTempPollinationDateTimePicker"
													displayFormat="yyyy-MM-dd HH:mm"
													valueFormat="yyyy-MM-dd HH:mm"
													value="{
														path: 'newTempPollinationModel>/pollinationTimestamp'
													}"
													placeholder="Enter Date"
												/>
												<GenericTag
													text="{
														path: 'newTempPollinationModel>/pollenType'
													}"
													design="StatusIconHidden"
													status="{= (${newTempPollinationModel>/pollenType} === 'fresh' ? 'Success' : 'Information') }"
												/>
											</HBox>
											<SegmentedButton
												selectedKey="{
													path: 'newTempPollinationModel>/location'
												}"
												class="sapUiTinyMarginBottom"
												width="17rem"
											>
												<items>
													<SegmentedButtonItem
														text="{i18n>AppView.Indoor}"
														key="indoor"
													/>
													<SegmentedButtonItem
														text="{i18n>AppView.IndoorLED}"
														key="indoor_led"
													/>
													<SegmentedButtonItem
														text="{i18n>AppView.Outdoor}"
														key="outdoor"
													/>
												</items>
											</SegmentedButton>
											<HBox>
												<ColorPalette
													id="newTempPollinationColorPalette"
													colorSelect=".onColorSelect"
													colors="{
														path: 'newTempPollinationModel>/availableColorsRgb'
													}"
												/>
												<FlexBox alignItems="Center">
													<core:Icon
														src="sap-icon://color-fill"
														color="{
															path: 'newTempPollinationModel>/labelColorRgb'
														}"
														size="3rem"
													>
														<core:layoutData>
															<FlexItemData growFactor="1"/>
														</core:layoutData>
													</core:Icon>
												</FlexBox>
											</HBox>
											<FlexBox justifyContent="End">
												<Button
													enabled="{=
														!!${newTempPollinationModel>/florescencePlantName} 
														&amp;&amp; !!${newTempPollinationModel>/pollenDonorPlantName} 
														&amp;&amp; ${newTempPollinationModel>/florescenceStatus} === 'flowering' 
													}"
													text="{i18n>AppView.Preview}"
													type="Emphasized"
													press=".onPressAddButton"
												/>
											</FlexBox>
										</VBox>
									</f:content>
								</f:Card>
								<f:GridList
									id="newPollinationsList"
									headerText="New Pollinations (not saved, yet)"
									items="{
										path: 'newPollinationsModel>/'
									}"
									class="sapUiResponsiveContentPadding"
								>
									<f:customLayout>
										<grid:GridBasicLayout
											gridTemplateColumns="repeat(auto-fit, minmax(16rem, 16rem)
												)"
											gridGap="0.5rem"
										/>
									</f:customLayout>
									<f:GridListItem highlight="{= (${newPollinationsModel>pollenType} === 'fresh' ? 'Success' : 'Information') }">
										<VBox class="sapUiSmallMargin">
											<HBox>
												<FormattedText
													htmlText="&lt;strong&gt;{
														path: 'newPollinationsModel>seedCapsulePlantId'
													}&lt;/strong&gt; 
														{
														path: 'newPollinationsModel>seedCapsulePlantName'
													} &lt;strong&gt;â˜“&lt;/strong&gt; 
														&lt;strong&gt;{
														path: 'newPollinationsModel>pollenDonorPlantId'
													}&lt;/strong&gt; 
														{
														path: 'newPollinationsModel>pollenDonorPlantName'
													}"
													class="sapUiTinyMarginBottom"
												/>
												<Button
													id="BadgedButton"
													class="sapUiTinyMarginBeginEnd"
													icon="sap-icon://delete"
													type="Transparent"
													press=".onPressDeleteNewPollinationButton"
												/>
											</HBox>
											<GenericTag
												text="{
													path: 'newPollinationsModel>pollinationTimestamp'
												}"
												design="StatusIconHidden"
												class="sapUiTinyMarginEnd"
											/>
											<HBox>
												<GenericTag
													text="{
														path: 'newPollinationsModel>pollenType'
													}"
													design="StatusIconHidden"
													status="{= (${newPollinationsModel>pollenType} === 'fresh' ? 'Success' : 'Information') }"
													class="sapUiTinyMarginEnd"
												/>
												<GenericTag
													text="{
														path: 'newPollinationsModel>locationText'
													}"
													design="StatusIconHidden"
													class="sapUiTinyMarginEnd"
												/>
											</HBox>
											<HBox>
												<core:Icon
													src="sap-icon://color-fill"
													color="{
														path: 'newPollinationsModel>labelColorRgb'
													}"
													size="3rem"
													tooltip="{
														path: 'newPollinationsModel>labelColorRgb'
													}"
												>
													<core:layoutData>
														<FlexItemData growFactor="1"/>
													</core:layoutData>
												</core:Icon>
												<Button
													text="Save"
													type="Emphasized"
													press=".onPressSaveNewPollinationButton"
												/>
											</HBox>
											<!-- </VBox> -->
											<!-- </f:content> -->
											<!-- </f:Card> -->
										</VBox>
										<!-- </CustomListItem> -->
										<!-- </List> -->
									</f:GridListItem>
									<f:layoutData>
										<FlexItemData growFactor="1"/>
									</f:layoutData>
								</f:GridList>
								<!-- </HBox> -->
							</HBox>
							<f:GridList
								headerText="Ongoing Pollinations"
								id="ongoingPollinationsList"
								items="{
									path: 'ongoingPollinationsModel>/',
									sorter: [{
										path: 'pollination_status',
										descending: false,
										group: '.getPollinationStatusGroup',
										comparator: '.getPollinationStatusComparator'
									}, {
										path: 'seed_capsule_plant_name',
										descending: true
									}]
								}"
								class="sapUiResponsiveContentPadding"
							>
								<f:headerToolbar>
									<Toolbar style="Clear">
										<SearchField
											placeholder="Filter Ongoing Pollinations by Plant Name, Plant ID, Pollen Type, or Pollination Date"
											liveChange=".onLiveChangeOngoingPollinationsFilter"
											width="100%"
										/>
									</Toolbar>
								</f:headerToolbar>
								<f:customLayout>
									<grid:GridBasicLayout
										gridTemplateColumns="repeat(auto-fit, minmax(16rem, 16rem)
											)"
										gridGap="0.5rem"
									/>
								</f:customLayout>
								<f:GridListItem highlight="{= (${ongoingPollinationsModel>pollen_type} === 'fresh' ? 'Success' : 'Information') }">
									<VBox class="sapUiSmallMargin">
										<HBox alignItems="Center">
											<core:Icon
												src="sap-icon://color-fill"
												color="{
													path: 'ongoingPollinationsModel>label_color_rgb'
												}"
												size="3rem"
												tooltip="{
													path: 'ongoingPollinationsModel>label_color_rgb'
												}"
											>
												<core:layoutData>
													<FlexItemData growFactor="1"/>
												</core:layoutData>
											</core:Icon>
											<FlexBox>
												<GenericTag
													text="{= (!!${ongoingPollinationsModel>pollination_timestamp} ? ${ongoingPollinationsModel>pollination_timestamp} : 'unknown date') }"
													design="StatusIconHidden"
													class="sapUiTinyMarginEnd"
												/>
											</FlexBox>
											<Button
												icon="sap-icon://edit"
												type="Transparent"
												press=".onPressEditOngoingPollination"
											/>
										</HBox>
										<HBox>
											<FormattedText
												htmlText="&lt;strong&gt;{
													path: 'ongoingPollinationsModel>seed_capsule_plant_id'
												}&lt;/strong&gt; 
													{
													path: 'ongoingPollinationsModel>seed_capsule_plant_name'
												} &lt;strong&gt;â˜“&lt;/strong&gt; 
													&lt;strong&gt;{
													path: 'ongoingPollinationsModel>pollen_donor_plant_id'
												}&lt;/strong&gt; 
													{
													path: 'ongoingPollinationsModel>pollen_donor_plant_name'
												}"
												class="sapUiTinyMarginBottom"
											/>
										</HBox>
										<HBox>
											<GenericTag
												text="{
													path: 'ongoingPollinationsModel>pollen_type'
												}"
												design="StatusIconHidden"
												status="{= (${ongoingPollinationsModel>pollen_type} === 'fresh' ? 'Success' : 'Information') }"
												class="sapUiTinyMarginEnd"
											/>
											<GenericTag
												text="{
													path: 'ongoingPollinationsModel>location_text'
												}"
												design="StatusIconHidden"
												class="sapUiTinyMarginEnd"
											/>
										</HBox>
									</VBox>
								</f:GridListItem>
							</f:GridList>
						</VBox>
					</f:content>
				</f:DynamicPage>
			</content>
		</Page>
	</App>
</mvc:View>