<mvc:View
	xmlns:mvc="sap.ui.core.mvc"
	xmlns:core="sap.ui.core"
	xmlns="sap.m"
	xmlns:f="sap.f"
	xmlns:card="sap.f.cards"
	xmlns:grid="sap.ui.layout.cssgrid"
	xmlns:html="http://www.w3.org/1999/xhtml"
	core:require="{
		Helper: 'pollination/ui/util/Helper',
		addMouseOverDelegate: 'pollination/ui/util/addMouseOverDelegate',
		addMouseOverDelegatePollenDonor: 'pollination/ui/util/addMouseOverDelegatePollenDonor'
	}"
	controllerName="pollination.ui.controller.App"
	displayBlock="true"

>
	<App>
		<Page>
			<customHeader>
				<f:ShellBar
					title="{i18n>AppView.Intitle}"
					homeIcon="././img/bee_favicon.svg"
				>
					<!-- homeIcon="{:= Helper.resolvePath('./img/bee_favicon.svg') }" -->
					<f:additionalContent>
						<OverflowToolbarButton
							icon="sap-icon://excel-attachment"
							tooltip="Open Flowering Plants Table"
							press=".onOverflowToolbarButtonPressOpenFlowerHistory"
						/>
						<OverflowToolbarButton
							icon="sap-icon://custom/flower"
							tooltip="{i18n>AppView.NewFlorescence}"
							press=".onPressNewActiveFlorescence"
						/>
						<OverflowToolbarButton
							icon="sap-icon://custom/pollen"
							tooltip="{i18n>AppView.MaintainPollenContainers}"
							press=".onPressOpenPollenContainersMaintenance"
						/>
						
						<OverflowToolbarButton
							icon="sap-icon://e-learning"
							tooltip="Retrain Machine Learning Models"
							press=".onPressOpenRetrainModelMenu"
						/>
					</f:additionalContent>
				</f:ShellBar>
			</customHeader>
			<content>
				<f:DynamicPage>
					<f:content>
						<VBox width="100%">
							<HBox alignItems="Start">
								<ScrollContainer
									height="18rem"
									width="100%"
									vertical="true"
									horizontal="false"
									focusable="true"
								>
									<List
										id="activeFlorescencesList"
										items="{
											path: 'currentFlorescencesModel>/',
											sorter: [{
												path: 'florescence_status',
												descending: false,
												group: '.getFlorescenceStatusGroup'
											}, {
												path: 'first_flower_opened_at',
												descending: true
											}]
										}"
										mode="SingleSelectMaster"
										growing="true"
										growingScrollToLoad="true"
										showNoData="false"
										showSeparators="Inner"
										selectionChange="onSelectionChangedCurrentFlorescence"
										class="sapUiSmallMarginEnd"
									>
										<CustomListItem>
											<HBox>
												<HBox>
													<VBox>
														<Text
															text="{currentFlorescencesModel>plant_id}"
															class="sapUiTinyMarginBegin"
															width="1.6rem"
														/>
														<Button
															class="tinyButton sapUiTinyMarginBegin"
															icon="sap-icon://edit"
															type="Transparent"
															press=".onPressEditActiveFlorescence"
														/>
													</VBox>
													<Text
														text="{=
															${currentFlorescencesModel>plant_name} + 
															(!!${currentFlorescencesModel>comment} ? ' [' + ${currentFlorescencesModel>comment} + ']' : '')
														}"
														class="sapUiTinyMarginBegin"
														width="16rem"
													/>
													<Text
														text="â¸™ {currentFlorescencesModel>branches_count}"
														tooltip="{currentFlorescencesModel>branches_count} branch(es)"
														class="sapUiTinyMarginBegin"
														width="1.4rem"
													/>
													<Text
														text="â• {currentFlorescencesModel>flowers_count}"
														tooltip="{currentFlorescencesModel>flowers_count} flowers"
														class="sapUiTinyMarginBegin"
														width="2rem"
													/>
													<VBox alignItems="Center">
														<FormattedText
															htmlText="{
																parts: ['currentFlorescencesModel>inflorescence_appeared_at', 'currentFlorescencesModel>first_flower_opened_at', 'currentFlorescencesModel>last_flower_closed_at', 'currentFlorescencesModel>florescence_status'],
																formatter: '.formatter.html_for_active_florescence_dates'
															}"
															tooltip="Inflorescence appeared: {currentFlorescencesModel>inflorescence_appeared_at}, First flower opens: {currentFlorescencesModel>first_flower_opened_at}, Last flower closed: {currentFlorescencesModel>last_flower_closed_at}"
															width="3.5rem"
														/>
														<HBox visible="{=
															!!${currentFlorescencesModel>flower_color} || !!${currentFlorescencesModel>flower_color_second}
														}">
															<core:Icon
																visible="{= 
																	!!${currentFlorescencesModel>flower_color}
																}"
																src="sap-icon://color-fill"
																color="{currentFlorescencesModel>flower_color}"
																size="0.7rem"
															>
																<core:layoutData>
																	<FlexItemData growFactor="1"/>
																</core:layoutData>
															</core:Icon>
															<core:Icon
																visible="{= 
																	!!${currentFlorescencesModel>flower_color_second}
																}"
																src="sap-icon://color-fill"
																color="{currentFlorescencesModel>flower_color_second}"
																size="0.7rem"
															>
																<core:layoutData>
																	<FlexItemData growFactor="1"/>
																</core:layoutData>
															</core:Icon>
														</HBox>
													</VBox>
												</HBox>
												<Avatar
													displaySize="XS"
													showBorder="true"
													initials="{= ${currentFlorescencesModel>plant_name}.substr(0,2) }"
													src="{
														path: 'currentFlorescencesModel>plant_preview_image_id',
														formatter: '.formatter.getImageUrlAvatarXS'
													}"
													tooltip="{
														path: 'currentFlorescencesModel>plant_preview_image_id',
														formatter: 'addMouseOverDelegate'
													}"
													displayShape="Square"
												/>
												<!-- <Button
													icon="sap-icon://edit"
													type="Transparent"
													press=".onPressEditActiveFlorescence"
												/> -->
											</HBox>
										</CustomListItem>
									</List>
									<layoutData>
										<FlexItemData growFactor="1"/>
									</layoutData>
								</ScrollContainer>
								<ScrollContainer
									height="18rem"
									width="100%"
									class="sapUiSmallMarginEnd"
									vertical="true"
									horizontal="false"
									focusable="true"
								>
									<List
										id="potentialPollenDonorsList"
										items="{
											path: 'potentialPollenDonorsModel>/',
											sorter: {
												path: 'pollen_type',
												descending: false,
												group: '.getPollenTypeGroup'
											}
										}"
										mode="SingleSelectMaster"
										growing="true"
										growingScrollToLoad="true"
										showNoData="false"
										showSeparators="Inner"
										selectionChange="onSelectionChangedPollenDonor"
									>
										<CustomListItem highlight="{=
											(${potentialPollenDonorsModel>already_ongoing_attempt} ? 'Error' : 'None') 
										}">
											<HBox>
												<!-- <CheckBox selected="{completed}"  /> -->
												<HBox justifyContent="Center">
													<Avatar
														displaySize="XS"
														showBorder="true"
														initials="{= ${potentialPollenDonorsModel>plant_name}.substr(0,2) }"
														src="{
															path: 'potentialPollenDonorsModel>plant_preview_image_id',
															formatter: '.formatter.getImageUrlAvatarXS'
														}"
														tooltip="{
															path: 'potentialPollenDonorsModel>plant_preview_image_id',
															formatter: 'addMouseOverDelegatePollenDonor'
														}"
														displayShape="Square"
													/>
													<Text
														text="{potentialPollenDonorsModel>plant_id}"
														class="sapUiTinyMarginBegin"
														width="1.6rem"
													/>
													<Text
														text="{potentialPollenDonorsModel>plant_name}"
														class="sapUiTinyMarginBeginEnd"
														width="16rem"
													/>
													<FormattedText
														width="2.5rem"
														htmlText="{
															parts: ['potentialPollenDonorsModel>probability_pollination_to_seed'],
															formatter: '.formatter.html_for_pollination_probability'
														}"
														tooltip="{= ${potentialPollenDonorsModel>probability_pollination_to_seed}.toString() + '%' }"
														class="sapUiTinyMarginBeginEnd"
													/>
													<HBox
														width="5.5rem"
														items="{
															path: 'potentialPollenDonorsModel>pollination_attempts',
															templateShareable: false
														}"
														
													>
														<CustomListItem>
															<FormattedText
																htmlText="{
																	parts: ['potentialPollenDonorsModel>pollination_status', 'potentialPollenDonorsModel>ongoing', 'potentialPollenDonorsModel>reverse'],
																	formatter: '.formatter.html_for_pollination_status_indicator'
																}"
																tooltip="{
																	parts: [
																	'potentialPollenDonorsModel>'],
																	formatter: '.formatter.tooltip_for_pollination_status_indicator'
																}"
																/>
														</CustomListItem>
													</HBox>
													<!-- tooltip="status: {potentialPollenDonorsModel>pollination_status}, pollinated: {potentialPollenDonorsModel>pollination_at}, harvested: {potentialPollenDonorsModel>harvest_at}" -->
															
													<!-- visible="{= ${potentialPollenDonorsModel>pollen_type} === 'frozen' }" -->
													<FormattedText
														width="4.5rem"
														htmlText="{
															path: 'potentialPollenDonorsModel>count_stored_pollen_containers',
															formatter: '.formatter.html_for_count_stored_pollen_containers'
														}"
														tooltip="{= ${potentialPollenDonorsModel>count_stored_pollen_containers} +
															' container(s) left' }"
														class="sapUiTinyMarginBeginEnd"
													/>
													<HBox
														width="4.5rem"
														items="{
															path: 'potentialPollenDonorsModel>resulting_plants',
															templateShareable: false
														}"
													>
														<CustomListItem>
															<Label
																text="{= (${potentialPollenDonorsModel>reverse} ? '(ðŸŒ±)' : 'ðŸŒ±' ) }"
																tooltip="{= ${potentialPollenDonorsModel>plant_id} +
																	' '+ ${potentialPollenDonorsModel>plant_name} }"
															/>
														</CustomListItem>
													</HBox>
												</HBox>
											</HBox>
										</CustomListItem>
									</List>
									<layoutData>
										<FlexItemData growFactor="2"/>
									</layoutData>
								</ScrollContainer>
							</HBox>
							<HBox>
								<f:Card
									class="sapUiMediumMargin"
									width="300px"
								>
									<f:header>
										<card:Header
											title="New pollination attempt"
											subtitle="Plant: {newTempPollinationInput>/florescencePlantName}"
											iconSrc="sap-icon://add"
											iconBackgroundColor="Accent5"
										/>
									</f:header>
									<f:content>
										<VBox class="sapUiSmallMargin">
											<VBox class="sapUiTinyMarginBottom">
												<Input
													id="florescencePlantNameInput"
													value="{newTempPollinationInput>/florescencePlantId} {newTempPollinationInput>/florescencePlantName}"
													editable="false"
													tooltip="{newTempPollinationInput>/florescencePlantId} {newTempPollinationInput>/florescencePlantName}"
												/>
												<HBox>
													<Input
														id="pollenDonorPlantNameInput"
														value="{newTempPollinationInput>/pollen_donor_plant_id} {newTempPollinationInput>/pollenDonorPlantName}"
														editable="false"
														tooltip="{newTempPollinationInput>/pollen_donor_plant_id} {newTempPollinationInput>/pollenDonorPlantName}"
													/>
													<Switch
														state="{newTempPollinationInput>/goodPollenQuality}"
														customTextOn="+"
														customTextOff="-"
														tooltip="Pollen Quality: Good / Bad"
													>
														<layoutData>
															<FlexItemData growFactor="1"/>
														</layoutData>
													</Switch>
												</HBox>
											</VBox>
											<HBox
												justifyContent="SpaceBetween"
												alignItems="Center"
												class="sapUiTinyMarginBottom"
											>
												<DateTimePicker
													width="11rem"
													id="newTempPollinationDateTimePicker"
													displayFormat="yyyy-MM-dd HH:mm"
													valueFormat="yyyy-MM-dd HH:mm"
													value="{
														path: 'newTempPollinationInput>/pollinated_at'
													}"
													placeholder="Enter Date"
												/>
												<GenericTag
													text="{
														path: 'newTempPollinationInput>/pollen_type'
													}"
													design="StatusIconHidden"
													status="{= (${newTempPollinationInput>/pollen_type} === 'fresh' ? 'Success' : 'Information') }"
												/>
											</HBox>
											<!-- <HBox> -->
											<SegmentedButton
												selectedKey="{
													path: 'newTempPollinationInput>/location'
												}"
												class="sapUiTinyMarginBottom"
												width="14rem"
											>
												<items>
													<SegmentedButtonItem
														text="{i18n>AppView.Indoor}"
														key="indoor"
													/>
													<SegmentedButtonItem
														text="{i18n>AppView.IndoorLED}"
														key="indoor_led"
													/>
													<SegmentedButtonItem
														text="{i18n>AppView.Outdoor}"
														key="outdoor"
													/>
												</items>
											</SegmentedButton>
											<!-- </HBox> -->
											<HBox>
												<ColorPalette
													id="newTempPollinationColorPalette"
													colorSelect=".onColorSelect"
													colors="{
														path: 'newTempPollinationInput>/availableColorsRgb'
													}"
												/>
												<FlexBox alignItems="Center">
													<core:Icon
														src="sap-icon://color-fill"
														color="{
															path: 'newTempPollinationInput>/label_color_rgb'
														}"
														size="3rem"
													>
														<core:layoutData>
															<FlexItemData growFactor="1"/>
														</core:layoutData>
													</core:Icon>
												</FlexBox>
											</HBox>
											<HBox justifyContent="SpaceBetween">
												<StepInput
													description="Flowers"
													max="9"
													min="1"
													required="true"
													textAlign="Center"
													value="{newTempPollinationInput>/count_attempted}"
												/>
												<FlexBox>
													<Button
														enabled="{=
															!!${newTempPollinationInput>/florescencePlantName} 
															&amp;&amp; !!${newTempPollinationInput>/pollenDonorPlantName} 
															&amp;&amp; ${newTempPollinationInput>/florescenceStatus} === 'flowering' 
														}"
														text="{i18n>AppView.Preview}"
														type="Emphasized"
														press=".onPressAddAsPollinationPreview"
													/>
												</FlexBox>
											</HBox>
										</VBox>
									</f:content>
								</f:Card>
								<f:GridList
									id="newPollinationsList"
									headerText="New Pollinations (not saved, yet)"
									items="{
										path: 'newPollinationsModel>/'
									}"
									class="sapUiResponsiveContentPadding"
								>
									<f:customLayout>
										<grid:GridBasicLayout
											gridTemplateColumns="repeat(auto-fit, minmax(16rem, 16rem)
												)"
											gridGap="0.5rem"
										/>
									</f:customLayout>
									<f:GridListItem highlight="{= (${newPollinationsModel>pollen_type} === 'fresh' ? 'Success' : 'Information') }">
										<VBox class="sapUiSmallMargin">
											<HBox>
												<VBox>
													<FormattedText
														htmlText="&lt;strong&gt;{
															path: 'newPollinationsModel>seed_capsule_plant_id'
														}&lt;/strong&gt; 
															{
															path: 'newPollinationsModel>seedCapsulePlantName'
														} &lt;strong&gt;â˜“&lt;/strong&gt; 
															&lt;strong&gt;{
															path: 'newPollinationsModel>pollen_donor_plant_id'
														}&lt;/strong&gt; 
															{
															path: 'newPollinationsModel>pollenDonorPlantName'
														}"
														class="sapUiTinyMarginBottom"
													/>
													<Label
														visible="{=
															!!${newPollinationsModel>florescence_comment}
														}"
														text="{newPollinationsModel>florescence_id} ({newPollinationsModel>florescence_comment})"
														tooltip="{newPollinationsModel>florescence_id} ({newPollinationsModel>florescence_comment})"
													/>
												</VBox>
												<Button
													id="BadgedButton"
													class="sapUiTinyMarginBeginEnd"
													icon="sap-icon://delete"
													type="Transparent"
													press=".onPressDeleteNewPollinationButton"
												/>
											</HBox>
											<HBox>
												<GenericTag
													text="{
														path: 'newPollinationsModel>pollinated_at'
													}"
													design="StatusIconHidden"
													class="sapUiTinyMarginEnd"
												/>
												<GenericTag
													visible="{= (!!${newPollinationsModel>count_attempted}) }"
													text="{newPollinationsModel>count_attempted} fl."
													tooltip="{newPollinationsModel>count_attempted} flower(s)"
													design="StatusIconHidden"
													class="sapUiTinyMarginEnd"
													status="Warning"
												/>
											</HBox>
											<HBox>
												<GenericTag
													text="{
														path: 'newPollinationsModel>pollen_type'
													}"
													design="StatusIconHidden"
													status="{= (${newPollinationsModel>pollen_type} === 'fresh' ? 'Success' : 'Information') }"
													class="sapUiTinyMarginEnd"
												/>
												<GenericTag
													text="{
														path: 'newPollinationsModel>locationText'
													}"
													design="StatusIconHidden"
													class="sapUiTinyMarginEnd"
												/>
												<GenericTag
													text="{=
														${newPollinationsModel>pollen_quality}
													}"
													tooltip="Pollen Quality: {newPollinationsModel>pollen_quality}"
													design="StatusIconHidden"
													class="sapUiTinyMarginEnd"
													status="{=
														${newPollinationsModel>pollen_quality} === 'good' ? 'Success' : 'Warning'
													}"
												/>
											</HBox>
											<HBox>
												<core:Icon
													src="sap-icon://color-fill"
													color="{
														path: 'newPollinationsModel>label_color_rgb'
													}"
													size="3rem"
													tooltip="{
														path: 'newPollinationsModel>label_color_rgb'
													}"
												>
													<core:layoutData>
														<FlexItemData growFactor="1"/>
													</core:layoutData>
												</core:Icon>
												<Button
													text="Save"
													type="Emphasized"
													press=".onPressSaveNewPollinationButton"
												/>
											</HBox>
											<!-- </VBox> -->
											<!-- </f:content> -->
											<!-- </f:Card> -->
										</VBox>
										<!-- </CustomListItem> -->
										<!-- </List> -->
									</f:GridListItem>
									<f:layoutData>
										<FlexItemData growFactor="1"/>
									</f:layoutData>
								</f:GridList>
								<!-- </HBox> -->
							</HBox>
							
							<html:hr></html:hr>
							
							<f:GridList
								headerText="Ongoing Pollinations"
								id="ongoingPollinationsList"
								items="{
									path: 'ongoingPollinationsModel>/',
									sorter: [
										{
											path: 'seed_capsule_plant_name',
											group: '.getSeedCapsulePlantGroup'
										}, {
											path: 'florescence_id'
										}, {
											path: 'pollinated_at'
										}, {
											path: 'pollination_status',
											descending: false
										}
									],
									groupHeaderFactory: '.getGroupHeader',
									filters : [
										{ path : 'pollination_status', operator : 'EQ', value1 : 'attempt'},
										{ path : 'pollination_status', operator : 'EQ', value1 : 'seed_capsule'}
									], and: false								
								}"
								class="sapUiResponsiveContentPadding"
							>
								<f:headerToolbar>
									<Toolbar style="Clear">
										<SearchField
											placeholder="Filter Ongoing Pollinations by Plant Name, Plant ID, Pollen Type, or Pollination Date"
											liveChange=".onLiveChangeOngoingPollinationsFilter"
											width="100%"
										/>
									</Toolbar>
								</f:headerToolbar>
								<f:customLayout>
									<grid:GridBasicLayout
										gridTemplateColumns="repeat(auto-fit, minmax(16rem, 16rem)
											)"
										gridGap="0.5rem"
									/>
								</f:customLayout>

								<f:GridListItem 
									highlight="{= (${ongoingPollinationsModel>pollen_type} === 'fresh' ? 'Success' : 'Information') }"
									class="formatByOngoing ongoingPollinationStatus">
								
									<f:customData>
										<core:CustomData 
											xmlns:core="sap.ui.core" 
											key="pollination_status" 
											value="{ongoingPollinationsModel>pollination_status}" 
											writeToDom="true"/>
										<core:CustomData 
											xmlns:core="sap.ui.core" 
											key="is_ongoing" 
											value="{= ${ongoingPollinationsModel>ongoing}.toString() }" 
											writeToDom="true"/>
									</f:customData>

									<VBox class="sapUiSmallMargin">
										<HBox alignItems="Start">
											<core:Icon
												src="sap-icon://color-fill"
												color="{
													path: 'ongoingPollinationsModel>label_color_rgb'
												}"
												size="3rem"
												tooltip="{
													path: 'ongoingPollinationsModel>label_color_rgb'
												}"
											>
												<core:layoutData>
													<FlexItemData growFactor="1"/>
												</core:layoutData>
											</core:Icon>
											<!-- <Label
												text="ðŸ–Œ"
											>
											</Label> -->
											<VBox>
												<GenericTag
													text="{= (!!${ongoingPollinationsModel>pollinated_at} ? ${ongoingPollinationsModel>pollinated_at} : 'unknown date') }"
													design="StatusIconHidden"
													class="sapUiTinyMarginEnd"
												/>
												<ProgressIndicator
													class="sapUiSmallMarginBottom"
													displayValue="{ongoingPollinationsModel>current_ripening_days} / {ongoingPollinationsModel>predicted_ripening_days}"
													percentValue="{= (${ongoingPollinationsModel>current_ripening_days} / ${ongoingPollinationsModel>predicted_ripening_days}) * 100 }"
													visible="{= !!${ongoingPollinationsModel>predicted_ripening_days} }"
													
													
													state="{
														parts: ['ongoingPollinationsModel>current_ripening_days', 'ongoingPollinationsModel>predicted_ripening_days'],
														formatter: '.formatter.seed_ripening_progress_indicator_state'
													}"
													
													/>
											</VBox>
											<!-- <FlexBox> -->
											<Button
												visible="{= !!${ongoingPollinationsModel>ongoing} }"
												icon="sap-icon://edit"
												type="Transparent"
												press=".onPressEditOngoingPollination"
											/>
											<!-- </FlexBox> -->
										</HBox>
										<VBox>
											<FormattedText
												htmlText="&lt;strong&gt;{
													path: 'ongoingPollinationsModel>seed_capsule_plant_id'
												}&lt;/strong&gt; 
													{
													path: 'ongoingPollinationsModel>seed_capsule_plant_name'
												} &lt;strong&gt;â˜“&lt;/strong&gt; 
													&lt;strong&gt;{
													path: 'ongoingPollinationsModel>pollen_donor_plant_id'
												}&lt;/strong&gt; 
													{
													path: 'ongoingPollinationsModel>pollen_donor_plant_name'
												}"
												class="sapUiTinyMarginBottom"
											/>
										</VBox>
										<HBox wrap="Wrap">
											<GenericTag
												text="{
													path: 'ongoingPollinationsModel>pollen_type'
												}"
												design="StatusIconHidden"
												status="{= (${ongoingPollinationsModel>pollen_type} === 'fresh' ? 'Success' : 'Information') }"
												class="sapUiTinyMarginEnd"
											/>
											<GenericTag
												text="{
													path: 'ongoingPollinationsModel>location_text'
												}"
												design="StatusIconHidden"
												class="sapUiTinyMarginEnd"
											/>
											<GenericTag
												visible="{= (!!${ongoingPollinationsModel>count_attempted}) }"
												text="{ongoingPollinationsModel>count_attempted}"
												tooltip="{ongoingPollinationsModel>count_attempted} flower(s)"
												design="StatusIconHidden"
												class="sapUiTinyMarginEnd"
												status="Warning"
											/>
											<GenericTag
												text="{ongoingPollinationsModel>pollen_quality}"
												tooltip="Pollen Quality: {ongoingPollinationsModel>pollen_quality}"
												design="StatusIconHidden"
												class="sapUiTinyMarginEnd"
												status="{=
													${ongoingPollinationsModel>pollen_quality} === 'good' ? 'Success' : 'Warning'
												}"
											/>
										</HBox>
									</VBox>
								</f:GridListItem>
							</f:GridList>

							<html:hr></html:hr>


							<f:GridList
								items="{
									path: 'ongoingPollinationsModel>/',
									sorter: [{
										path: 'seed_capsule_plant_name',
										descending: true,
										group: '.getPollinationStatusGroup'
									}, {
										path: 'harvest_date',
										descending: false
									}],
									filters : [
										{ path : 'pollination_status', operator : 'EQ', value1 : 'seed'},
										{ path : 'pollination_status', operator : 'EQ', value1 : 'germinated'}
									], and: false
								}"
								class="sapUiResponsiveContentPadding"
							>
								<f:customLayout>
									<grid:GridBasicLayout
										gridTemplateColumns="repeat(auto-fit, minmax(20rem, 20rem)
											)"
										gridGap="0.5rem"
									/>
								</f:customLayout>
								<f:GridListItem highlight="{= (${ongoingPollinationsModel>pollen_type} === 'fresh' ? 'Success' : 'Information') }">
									<VBox class="sapUiSmallMargin">
										<HBox alignItems="Center">
											<core:Icon
												src="sap-icon://color-fill"
												color="{
													path: 'ongoingPollinationsModel>label_color_rgb'
												}"
												size="3rem"
												tooltip="{
													path: 'ongoingPollinationsModel>label_color_rgb'
												}"
											>
												<core:layoutData>
													<FlexItemData growFactor="1"/>
												</core:layoutData>
											</core:Icon>
											<FlexBox>
												<GenericTag
													text="{= (!!${ongoingPollinationsModel>pollinated_at} ? ${ongoingPollinationsModel>pollinated_at} : 'unknown date') }"
													design="StatusIconHidden"
													class="sapUiTinyMarginEnd"
												/>
											</FlexBox>
											<Button
												icon="sap-icon://edit"
												type="Transparent"
												press=".onPressEditOngoingPollination"
											/>
										</HBox>
										<VBox>
											<FormattedText
												htmlText="&lt;strong&gt;{
													path: 'ongoingPollinationsModel>seed_capsule_plant_id'
												}&lt;/strong&gt; 
													{
													path: 'ongoingPollinationsModel>seed_capsule_plant_name'
												} &lt;strong&gt;â˜“&lt;/strong&gt; 
													&lt;strong&gt;{
													path: 'ongoingPollinationsModel>pollen_donor_plant_id'
												}&lt;/strong&gt; 
													{
													path: 'ongoingPollinationsModel>pollen_donor_plant_name'
												}"
												class="sapUiTinyMarginBottom"
											/>
											<Label
												visible="{=
													!!${ongoingPollinationsModel>florescence_comment}
												}"
												text="{ongoingPollinationsModel>florescence_id} ({ongoingPollinationsModel>florescence_comment})"
												tooltip="{ongoingPollinationsModel>florescence_id} ({ongoingPollinationsModel>florescence_comment})"
											/>
										</VBox>
										<HBox wrap="Wrap">
											<GenericTag
												text="{
													path: 'ongoingPollinationsModel>pollen_type'
												}"
												design="StatusIconHidden"
												status="{= (${ongoingPollinationsModel>pollen_type} === 'fresh' ? 'Success' : 'Information') }"
												class="sapUiTinyMarginEnd"
											/>
											<GenericTag
												text="{
													path: 'ongoingPollinationsModel>location_text'
												}"
												design="StatusIconHidden"
												class="sapUiTinyMarginEnd"
											/>
											<GenericTag
												visible="{= (!!${ongoingPollinationsModel>count_attempted}) }"
												text="{ongoingPollinationsModel>count_attempted}"
												tooltip="{ongoingPollinationsModel>count_attempted} flower(s)"
												design="StatusIconHidden"
												class="sapUiTinyMarginEnd"
												status="Warning"
											/>
											<GenericTag
												text="{ongoingPollinationsModel>pollen_quality}"
												tooltip="Pollen Quality: {ongoingPollinationsModel>pollen_quality}"
												design="StatusIconHidden"
												class="sapUiTinyMarginEnd"
												status="{=
													${ongoingPollinationsModel>pollen_quality} === 'good' ? 'Success' : 'Warning'
												}"
											/>
										</HBox>

										<VBox>
											<HBox
												class="sapUiSmallMarginTop"
												justifyContent="SpaceBetween">
												<Title text="Seed Plantings"/>
												<Button
													icon="sap-icon://add"
													tooltip="Add Seed Planting"
													type="Transparent"
													press=".onPressAddSeedPlanting"
												/>
											</HBox>

											<List
												items="{ 
													path: 'ongoingPollinationsModel>seed_plantings/',
													sorter: [{ path: 'planted_on',
															descending: 'false'},
															{ path: 'id',
															descending: 'false'}],
													templateShareable:false
													}"
												mode="SingleSelectMaster"
												growing="true"
												growingScrollToLoad="true"
												showNoData="false"
												showSeparators="Inner"
												selectionChange=".onPressUpdateSeedPlanting"
											>
												<CustomListItem>
													<HBox>
														<VBox
															width="11rem"
															class="sapUiTinyMarginBegin">
															<Label 
																text="Planted on {ongoingPollinationsModel>planted_on}" 
																tooltip="Planted on {ongoingPollinationsModel>planted_on} (SeedPlanting ID {ongoingPollinationsModel>id})" 
																class="sapUiTinyMarginBottom"/>
															<Label 
																text="{ongoingPollinationsModel>soil_name}" 
																tooltip="{ongoingPollinationsModel>soil_name} (Soil ID {ongoingPollinationsModel>soil_id})" 
																class="sapUiTinyMarginBottom"/>
														<!-- </VBox>
														<VBox
															width="11rem"
															class="sapUiTinyMarginBegin"> -->
															<Label 
																text="Status: {ongoingPollinationsModel>status}" 
																tooltip="Status: {ongoingPollinationsModel>status}" 
																design="Bold"
																class="sapUiTinyMarginBottom"/>
															<Label 
																text="{ongoingPollinationsModel>comment}" 
																visible="{= !!${ongoingPollinationsModel>comment} }"
																tooltip="{ongoingPollinationsModel>comment}" 
																width="6rem"/>

															<VBox
																visible="{= ${ongoingPollinationsModel>status} === 'planted' }"
															>
																<Label 
																	text="{= 'Pred. Success: ' + ${ongoingPollinationsModel>predicted_germination_probability}.toString() + '%' }"
																	tooltip="{= 'Predicted Success: ' + ${ongoingPollinationsModel>predicted_germination_probability}.toString() + '%' }"
																	wrapping="true"/>
																	
																<ProgressIndicator
																	class="sapUiSmallMarginBottom"
																	displayValue="{ongoingPollinationsModel>current_germination_days} / {ongoingPollinationsModel>predicted_germination_days}"
																	percentValue="{= (${ongoingPollinationsModel>current_germination_days} / ${ongoingPollinationsModel>predicted_germination_days}) * 100 }"
																	visible="{= !!${ongoingPollinationsModel>predicted_germination_days} }"
																	
																	state="{
																		parts: ['ongoingPollinationsModel>current_germination_days', 'ongoingPollinationsModel>predicted_germination_days'],
																		formatter: '.formatter.germination_progress_indicator_state'
																	}"
																	tooltip="{= 'Current Days: ' + ${ongoingPollinationsModel>current_germination_days}.toString() + ' Days \n' + 
																	'Predicted Days: ' + ${ongoingPollinationsModel>predicted_germination_days}.toString() + ' Days \n' }"																	
																	/>
															</VBox>

															<VBox
																visible="{= ${ongoingPollinationsModel>status} === 'germinated' }"
															>
																<Label 
																	text="{= 'Germinated after ' + ${ongoingPollinationsModel>germination_days}.toString() + ' days' }"
																	wrapping="true"/>
															</VBox>
															

															<VBox
																visible="{= ${ongoingPollinationsModel>status} === 'abandoned' }"
															>
																<Label 
																	text="{= 'Abandoned after ' + ${ongoingPollinationsModel>germination_days}.toString() + ' days' }"
																	wrapping="true"/>
															</VBox>

														</VBox>
														<VBox
															class="sapUiTinyMarginBegin">
														<CheckBox
															text="Sterilized"
															tooltip="Sterilized Soil or sterilized seed (e.g. with Chinosol)"
															displayOnly="true"
															selected="{ongoingPollinationsModel>sterilized}"
														/>
														<CheckBox
															text="Soaked"
															tooltip="Seed soaked in water"
															displayOnly="true"
															selected="{ongoingPollinationsModel>soaked}"
														/>
														<CheckBox
															text="Covered"
															tooltip="Covered"
															displayOnly="true"
															selected="{ongoingPollinationsModel>covered}"
														/>
														</VBox>
													</HBox>


													<List
														showNoData="false"
														items="{
															path: 'ongoingPollinationsModel>plants',
															templateShareable:false
														}"
														showSeparators="Inner"
														class="sapUiSmallMarginBeginEnd">
														<CustomListItem>
															
															<GenericTag
																text="{
																	parts: ['ongoingPollinationsModel>id', 'ongoingPollinationsModel>plant_name'],
																	formatter: '.formatter.ellipsize'
																}"
																tooltip="{ongoingPollinationsModel>id} {ongoingPollinationsModel>plant_name}"
																design="StatusIconHidden"
																status="Success"
																class="sapUiTinyMarginEnd"
															/>
															<!-- <Label
																text="{ongoingPollinationsModel>id}"
																class="sapUiTinyMarginEnd" />
															<Label
																text="{ongoingPollinationsModel>plant_name}"
																tooltip="{ongoingPollinationsModel>plant_name}" /> -->
														</CustomListItem>
													</List>

												</CustomListItem>
											</List>


										</VBox>
									</VBox>
								</f:GridListItem>
							</f:GridList>

						</VBox>
					</f:content>
				</f:DynamicPage>
			</content>
		</Page>
	</App>
</mvc:View>