<mvc:View
	xmlns:mvc="sap.ui.core.mvc"
	xmlns:core="sap.ui.core"
	xmlns="sap.m"
	xmlns:f="sap.f"
	xmlns:grid="sap.ui.layout.cssgrid"
	xmlns:html="http://www.w3.org/1999/xhtml"
	core:require="{
		Helper: 'pollination/ui/util/Helper',
		addMouseOverDelegate: 'pollination/ui/util/addMouseOverDelegate',
		addMouseOverDelegatePollenDonor: 'pollination/ui/util/addMouseOverDelegatePollenDonor'
	}"
	controllerName="pollination.ui.controller.App"
	displayBlock="true"
>
	<App>
		<Page>
			<customHeader>
				<f:ShellBar
					title="{i18n>AppView.Intitle}"
					homeIcon="././img/bee_favicon.svg"
				>
					<f:additionalContent>
						<OverflowToolbarButton
							icon="sap-icon://excel-attachment"
							tooltip="Open Flowering Plants Table"
							press=".onOverflowToolbarButtonPressOpenFlowerHistory"
						/>
						<OverflowToolbarButton
							icon="sap-icon://custom/flower"
							tooltip="{i18n>AppView.NewFlorescence}"
							press=".onPressNewActiveFlorescence"
						/>
						<OverflowToolbarButton
							icon="sap-icon://custom/pollen"
							tooltip="{i18n>AppView.MaintainPollenContainers}"
							press=".onPressOpenPollenContainersMaintenance"
						/>
							<!-- icon="sap-icon://chart-axis" -->
						<OverflowToolbarButton
							icon="././img/pollination_statistics.svg"
							tooltip="{i18n>AppView.PollinationStatistics}"
							press=".onPressOpenPollinationStatistics"
						/>
						<OverflowToolbarButton
							icon="sap-icon://e-learning"
							tooltip="Retrain Machine Learning Models"
							press=".onPressOpenRetrainModelMenu"
						/>
						<OverflowToolbarButton
							icon="sap-icon://settings"
							tooltip="Settings and Filter"
							press=".onPressOpenFilterSettings"
						/>
					</f:additionalContent>
				</f:ShellBar>
			</customHeader>
			<content>
				<f:DynamicPage>
					<f:content>
						<VBox width="100%">
							
							<!-- <VBox> -->
							<!-- <VBox> -->
							<!-- <FlexBox> -->
							<ScrollContainer
							>
								<content>
									
									<HBox alignItems="Start"
										width="59rem"
										class="florescenceAndPollinationBox">
										<ScrollContainer
											height="24rem"
											width="27rem"
											vertical="true"
											horizontal="false"
											focusable="true"
										>
											<List
												id="activeFlorescencesList"
												items="{
													path: 'currentFlorescencesModel>/',
													sorter: [{
														path: 'florescence_status',
														descending: false,
														group: '.getFlorescenceStatusGroup'
													}, {
														path: 'plant_id',
														descending: false
													}]
												}"
												mode="SingleSelectMaster"
												growing="true"
												growingScrollToLoad="true"
												showNoData="false"
												showSeparators="Inner"
												selectionChange="onSelectionChangedCurrentFlorescence"
												class="sapUiSmallMarginEnd"
											>
												<core:Fragment
													fragmentName="pollination.ui.view.embedded.FlorescenceInLeftListTemplate"
													type="XML"
												/>
											</List>
											<layoutData>
												<FlexItemData growFactor="1" />
											</layoutData>
										</ScrollContainer>
										<ScrollContainer
											height="24rem"
											width="30rem"
											class="sapUiSmallMarginEnd"
											vertical="true"
											horizontal="false"
											focusable="true"
											id="potentialPollenDonorsScrollContainer"
										>
											<SegmentedButton 
												id="filterPotentialPollenDonors"
												selectedKey="fresh"
												selectionChange=".onFilterPotentialPollenDonors"
												enabled="{= !!${state>/seed_capsule_selected} }"
												>
												<items>
													<SegmentedButtonItem text="Fresh" key="fresh" />
													<SegmentedButtonItem text="Frozen" key="frozen" />
													<SegmentedButtonItem text="Both" key="both" />
												</items>
											</SegmentedButton>
											<List
												id="potentialPollenDonorsList"
												items="{
													path: 'potentialPollenDonorsModel>/',
													sorter: [{
														path: 'pollen_type',
														descending: false,
														group: '.getPollenTypeGroup'
													}, {
														path: 'plant_id',
														descending: false
													}]
												}"
												mode="SingleSelectMaster"
												growing="true"
												growingScrollToLoad="true"
												showNoData="false"
												showSeparators="Inner"
												selectionChange=".onSelectionChangedPotentialPollenDonor"
											>
												<core:Fragment
													fragmentName="pollination.ui.view.embedded.PollenInRightListTemplate"
													type="XML"
												/>
											</List>
											<layoutData>
												<FlexItemData growFactor="2" />
											</layoutData>
										</ScrollContainer>
									</HBox>
							
								</content>
								
							</ScrollContainer>
							<!-- </FlexBox> -->
							
							<!-- </VBox> -->
							<FlexBox
								width="32rem"
								justifyContent="End"
							>
								<Button
									icon="sap-icon://add"
									enabled="{= !!${state>/seed_capsule_selected} &amp;&amp; !!${state>/pollen_donor_selected} &amp;&amp; ${state>/florescence_status} === 'flowering' }"
									class="sapUiSmallMarginTop"
									press=".onPressAddNewPreviewPollination"
								/>
							</FlexBox>
							
							<!--  -->
							<!-- Unsaved Pollinations, displayed only if there are any -->
							<VBox visible="{= !!${newPollinationsModel>/}.length }">
								<f:GridList
									id="newPollinationsList"
									headerText="Unsaved Pollinations"
									items="{
										path: 'newPollinationsModel>/'
									}"
									class="sapUiResponsiveContentPadding"
								>
									<f:customLayout>
										<grid:GridBasicLayout
											gridTemplateColumns="repeat(auto-fit, minmax(16rem, 16rem)
												)"
											gridGap="0.5rem"
										/>
									</f:customLayout>
									<f:GridListItem highlight="{= (${newPollinationsModel>pollen_type} === 'fresh' ? 'Success' : 'Information') }">
										<core:Fragment
											fragmentName="pollination.ui.view.embedded.UnsavedPollination"
											type="XML"
										/>
									</f:GridListItem>
									<f:layoutData>
										<FlexItemData growFactor="1" />
									</f:layoutData>
								</f:GridList>
								<!-- @ui5ignore -->
								<html:hr>
								<!-- @ui5ignore -->
								</html:hr>
							</VBox>


							<!-- Ongoing Pollinations, displayed only if there are any -->
							<f:GridList
								headerText="Ongoing Pollinations"
								id="ongoingPollinationsList"
								items="{
									path: 'pollinationsModel>/',
									sorter: [{
										path: 'florescence_status',
										descending: true,
										group: '.getSeedCapsulePlantGroup'
									}, {
										path: 'florescence_min_current_ripening_days',
										descending: true
									}, {
										path: 'seed_capsule_plant_id'
									}, {
										path: 'florescence_id'
									}, {
										path: 'pollinated_at'
									}, {
										path: 'pollination_status',
										descending: false
									}],
									groupHeaderFactory: '.getGroupHeader',
									filters: [{
										path: 'pollination_status',
										operator: 'EQ',
										value1: 'attempt'
									}, {
										path: 'pollination_status',
										operator: 'EQ',
										value1: 'seed_capsule'
									}],
									and: false
								}"
								class="sapUiResponsiveContentPadding"
							>
								<f:headerToolbar>
									<Toolbar style="Clear" height="auto" >
										<VBox width="100%">
											<VBox>
												<HBox>
													<Button text="Reset" press="onSeedCapsulePlantsSelectNone" icon="sap-icon://clear-filter"/>
													<Button text="Currently Flowering" press="onSeedCapsulePlantsSelectCurrentlyFlowering" icon="sap-icon://sort-descending" />
													<Button text="Unsaved" press="onSeedCapsulePlantsSelectFromUnsaved" icon="sap-icon://sort-descending" enabled="{= !!${newPollinationsModel>/}.length }"/>
												</HBox>

												<f:GridList
													id="uniqueSeedCapsulePlantsList"
													items="{uniqueSeedCapsulePlantsModel>/}"
													>

													<f:GridListItem 
														press=".onPressSeedCapsulePlantForFiltering"
														type="Active"
														>
														<HBox 
															alignItems="Center" 
															height="55px"
															width="100%">
															<CheckBox
																selected="{uniqueSeedCapsulePlantsModel>selected}"
																select=".onSelectionChangedUniqueSeedCapsulePlants"
															/>
															<Text
																text="{uniqueSeedCapsulePlantsModel>plant_id} {uniqueSeedCapsulePlantsModel>plant_name}"
																maxLines="3"
															/>
														</HBox>
													</f:GridListItem>

												</f:GridList>
											</VBox>									

											<HBox justifyContent="SpaceBetween" alignItems="Center" width="100%" >
												<SearchField
													placeholder="... or filter by Plant Name, Plant ID, Pollen Type, or Pollination Date"
													liveChange=".onLiveChangeOngoingPollinationsFilter"
													width="100%"
												>
													<layoutData>
														<FlexItemData growFactor="1" />
													</layoutData>
												</SearchField>

												<SegmentedButton selectedKey="plant" selectionChange=".sortPollinationsWithPlantingsList"
													class="sapUiTinyMarginBegin">
													<items>
														<SegmentedButtonItem text="Sort &amp; Group by Parent Plant" key="plant" />
														<SegmentedButtonItem text="Sort by Harvest Date" key="elapsed_time" />
													</items>
												</SegmentedButton>
											</HBox>
										</VBox>
									</Toolbar>
								</f:headerToolbar>
								<f:customLayout>
									<grid:GridBasicLayout
										gridTemplateColumns="repeat(auto-fit, minmax(16rem, 16rem)
											)"
										gridGap="0.5rem"
									/>
								</f:customLayout>
								
								<core:Fragment
									fragmentName="pollination.ui.view.embedded.PollinationAttemptTemplate"
									type="XML"
								/>

							</f:GridList>
							<!-- @ui5ignore -->
							<html:hr>
								<!-- @ui5ignore -->
							</html:hr>




							<f:GridList
								id="pollinationsWithPlantingsList"
								items="{
									path: 'pollinationsModel>/',
									sorter: [{
										path: 'seed_capsule_plant_id',
										descending: false,
										group: '.getPollinationStatusGroup'
									}, {
										path: 'harvest_date',
										descending: false
									}],
									filters: [{
										path: 'pollination_status',
										operator: 'EQ',
										value1: 'seed'
									}, {
										path: 'pollination_status',
										operator: 'EQ',
										value1: 'germinated'
									}],
									and: false
								}"
								class="sapUiNoContentPadding"
							>
								<f:customLayout>
									<grid:GridBasicLayout
										gridTemplateColumns="repeat(auto-fit, minmax(20rem, 21rem)
											)"
										gridGap="0.5rem"
									/>
								</f:customLayout>
								<core:Fragment
									fragmentName="pollination.ui.view.embedded.PollinationWithPlantingsTemplate"
									type="XML"
								/>
							</f:GridList>
						</VBox>
					</f:content>
				</f:DynamicPage>
			</content>
		</Page>
	</App>
</mvc:View>