<mvc:View
	xmlns:mvc="sap.ui.core.mvc"
	xmlns:core="sap.ui.core"
	xmlns="sap.m"
	xmlns:f="sap.f"
	xmlns:grid="sap.ui.layout.cssgrid"
	xmlns:html="http://www.w3.org/1999/xhtml"
	core:require="{
		Helper: 'pollination/ui/util/Helper',
		addMouseOverDelegate: 'pollination/ui/util/addMouseOverDelegate',
		addMouseOverDelegatePollenDonor: 'pollination/ui/util/addMouseOverDelegatePollenDonor'
	}"
	controllerName="pollination.ui.controller.App"
	displayBlock="true"
>
	<App>
		<Page>
			<customHeader>
				<f:ShellBar
					title="{i18n>AppView.Intitle}"
					homeIcon="././img/bee_favicon.svg"
				>
					<f:additionalContent>
						<OverflowToolbarButton
							icon="sap-icon://excel-attachment"
							tooltip="Open Flowering Plants Table"
							press=".onOverflowToolbarButtonPressOpenFlowerHistory"
						/>
						<OverflowToolbarButton
							icon="sap-icon://custom/flower"
							tooltip="{i18n>AppView.NewFlorescence}"
							press=".onPressNewActiveFlorescence"
						/>
						<OverflowToolbarButton
							icon="sap-icon://custom/pollen"
							tooltip="{i18n>AppView.MaintainPollenContainers}"
							press=".onPressOpenPollenContainersMaintenance"
						/>
						<OverflowToolbarButton
							icon="sap-icon://e-learning"
							tooltip="Retrain Machine Learning Models"
							press=".onPressOpenRetrainModelMenu"
						/>
						<OverflowToolbarButton
							icon="sap-icon://settings"
							tooltip="Settings and Filter"
							press=".onPressOpenFilterSettings"
						/>
					</f:additionalContent>
				</f:ShellBar>
			</customHeader>
			<content>
				<f:DynamicPage>
					<f:content>
						<VBox width="100%">
							
							<!-- <VBox> -->
							<!-- <VBox> -->
							<!-- <FlexBox> -->
							<HBox alignItems="Start"
								width="70rem"
								class="florescenceAndPollinationBox">
								<ScrollContainer
									height="18rem"
									width="31rem"
									vertical="true"
									horizontal="false"
									focusable="true"
								>
									<List
										id="activeFlorescencesList"
										items="{
											path: 'currentFlorescencesModel>/',
											sorter: [{
												path: 'florescence_status',
												descending: false,
												group: '.getFlorescenceStatusGroup'
											}, {
												path: 'first_flower_opened_at',
												descending: true
											}]
										}"
										mode="SingleSelectMaster"
										growing="true"
										growingScrollToLoad="true"
										showNoData="false"
										showSeparators="Inner"
										selectionChange="onSelectionChangedCurrentFlorescence"
										class="sapUiSmallMarginEnd"
									>
										<core:Fragment
											fragmentName="pollination.ui.view.embedded.FlorescenceInLeftListTemplate"
											type="XML"
										/>
									</List>
									<layoutData>
										<FlexItemData growFactor="1" />
									</layoutData>
								</ScrollContainer>
								<ScrollContainer
									height="18rem"
									width="38rem"
									class="sapUiSmallMarginEnd"
									vertical="true"
									horizontal="false"
									focusable="true"
									id="potentialPollenDonorsScrollContainer"
								>
									<List
										id="potentialPollenDonorsList"
										items="{
											path: 'potentialPollenDonorsModel>/',
											sorter: {
												path: 'pollen_type',
												descending: false,
												group: '.getPollenTypeGroup'
											}
										}"
										mode="SingleSelectMaster"
										growing="true"
										growingScrollToLoad="true"
										showNoData="false"
										showSeparators="Inner"
										selectionChange=".onSelectionChangedPotentialPollenDonor"
									>
										<core:Fragment
											fragmentName="pollination.ui.view.embedded.PollenInRightListTemplate"
											type="XML"
										/>
									</List>
									<layoutData>
										<FlexItemData growFactor="2" />
									</layoutData>
								</ScrollContainer>
							</HBox>
							<!-- </FlexBox> -->
							
							<!-- </VBox> -->
							<FlexBox
								width="32rem"
								justifyContent="End"
							>
								<Button
									icon="sap-icon://add"
									enabled="{= !!${state>/seed_capsule_selected} &amp;&amp; !!${state>/pollen_donor_selected} }"
									class="sapUiSmallMarginTop"
									press=".onPressAddNewPreviewPollination"
								/>
							</FlexBox>
							
							<!--  -->
							<!-- Unsaved Pollinations, displayed only if there are any -->
							<VBox visible="{= !!${newPollinationsModel>/}.length }">
								<f:GridList
									id="newPollinationsList"
									headerText="Unsaved Pollinations"
									items="{
										path: 'newPollinationsModel>/'
									}"
									class="sapUiResponsiveContentPadding"
								>
									<f:customLayout>
										<grid:GridBasicLayout
											gridTemplateColumns="repeat(auto-fit, minmax(16rem, 18rem)
												)"
											gridGap="0.5rem"
										/>
									</f:customLayout>
									<f:GridListItem highlight="{= (${newPollinationsModel>pollen_type} === 'fresh' ? 'Success' : 'Information') }">
										<core:Fragment
											fragmentName="pollination.ui.view.embedded.UnsavedPollination"
											type="XML"
										/>
									</f:GridListItem>
									<f:layoutData>
										<FlexItemData growFactor="1" />
									</f:layoutData>
								</f:GridList>
								<!-- @ui5ignore -->
								<html:hr>
									<!-- @ui5ignore -->
								</html:hr>
							</VBox>
							<f:GridList
								headerText="Ongoing Pollinations"
								id="ongoingPollinationsList"
								items="{
									path: 'ongoingPollinationsModel>/',
									sorter: [{
										path: 'seed_capsule_plant_name',
										group: '.getSeedCapsulePlantGroup'
									}, {
										path: 'florescence_id'
									}, {
										path: 'pollinated_at'
									}, {
										path: 'pollination_status',
										descending: false
									}],
									groupHeaderFactory: '.getGroupHeader',
									filters: [{
										path: 'pollination_status',
										operator: 'EQ',
										value1: 'attempt'
									}, {
										path: 'pollination_status',
										operator: 'EQ',
										value1: 'seed_capsule'
									}],
									and: false
								}"
								class="sapUiResponsiveContentPadding"
							>
								<f:headerToolbar>
									<Toolbar style="Clear">
										<SearchField
											placeholder="Filter by Plant Name, Plant ID, Pollen Type, or Pollination Date"
											liveChange=".onLiveChangeOngoingPollinationsFilter"
											width="100%"
										/>
									</Toolbar>
								</f:headerToolbar>
								<f:customLayout>
									<grid:GridBasicLayout
										gridTemplateColumns="repeat(auto-fit, minmax(16rem, 16rem)
											)"
										gridGap="0.5rem"
									/>
								</f:customLayout>
								<f:GridListItem
									highlight="{= (${ongoingPollinationsModel>pollen_type} === 'fresh' ? 'Success' : 'Information') }"
									class="formatByOngoing ongoingPollinationStatus"
								>
									<f:customData>
										<core:CustomData
											xmlns:core="sap.ui.core"
											key="pollination_status"
											value="{ongoingPollinationsModel>pollination_status}"
											writeToDom="true"
										/>
										<core:CustomData
											xmlns:core="sap.ui.core"
											key="is_ongoing"
											value="{= ${ongoingPollinationsModel>ongoing}.toString() }"
											writeToDom="true"
										/>
									</f:customData>
									<VBox class="sapUiSmallMargin">
										<HBox alignItems="Start">
											<core:Icon
												src="sap-icon://color-fill"
												color="{
													path: 'ongoingPollinationsModel>label_color_rgb'
												}"
												size="3rem"
												tooltip="{
													path: 'ongoingPollinationsModel>label_color_rgb'
												}"
											>
												<core:layoutData>
													<FlexItemData growFactor="1" />
												</core:layoutData>
											</core:Icon>
											<!-- <Label
												text="ðŸ–Œ"
											>
											</Label> -->
											<VBox>
												<GenericTag
													text="{= (!!${ongoingPollinationsModel>pollinated_at} ? ${ongoingPollinationsModel>pollinated_at} : 'unknown date') }"
													design="StatusIconHidden"
													class="sapUiTinyMarginEnd"
												/>
												<ProgressIndicator
													class="sapUiSmallMarginBottom"
													displayValue="{ongoingPollinationsModel>current_ripening_days} / {ongoingPollinationsModel>predicted_ripening_days}"
													percentValue="{= (${ongoingPollinationsModel>current_ripening_days} / ${ongoingPollinationsModel>predicted_ripening_days}) * 100 }"
													visible="{= !!${ongoingPollinationsModel>predicted_ripening_days} }"
													state="{
														parts: [
															'ongoingPollinationsModel>current_ripening_days',
															'ongoingPollinationsModel>predicted_ripening_days'
														],
														formatter: '.formatter.seed_ripening_progress_indicator_state'
													}"
												/>
											</VBox>
											<!-- <FlexBox> -->
											<Button
												visible="{= !!${ongoingPollinationsModel>ongoing} }"
												icon="sap-icon://edit"
												type="Transparent"
												press=".onPressEditOngoingPollination"
											/>
											<!-- </FlexBox> -->
										</HBox>
										<VBox>
											<FormattedText
												htmlText="&lt;strong&gt;{
													path: 'ongoingPollinationsModel>seed_capsule_plant_id'
												}&lt;/strong&gt; 
													{
													path: 'ongoingPollinationsModel>seed_capsule_plant_name'
												} &lt;strong&gt;â˜“&lt;/strong&gt; 
													&lt;strong&gt;{
													path: 'ongoingPollinationsModel>pollen_donor_plant_id'
												}&lt;/strong&gt; 
													{
													path: 'ongoingPollinationsModel>pollen_donor_plant_name'
												}"
												class="sapUiTinyMarginBottom"
											/>
										</VBox>
										<HBox wrap="Wrap">
											<GenericTag
												text="{
													path: 'ongoingPollinationsModel>pollen_type'
												}"
												design="StatusIconHidden"
												status="{= (${ongoingPollinationsModel>pollen_type} === 'fresh' ? 'Success' : 'Information') }"
												class="sapUiTinyMarginEnd"
											/>
											<GenericTag
												text="{
													path: 'ongoingPollinationsModel>location_text'
												}"
												design="StatusIconHidden"
												class="sapUiTinyMarginEnd"
											/>
											<GenericTag
												visible="{= (!!${ongoingPollinationsModel>count_attempted}) }"
												text="{ongoingPollinationsModel>count_attempted}"
												tooltip="{ongoingPollinationsModel>count_attempted} flower(s)"
												design="StatusIconHidden"
												class="sapUiTinyMarginEnd"
												status="Warning"
											/>
											<GenericTag
												text="{ongoingPollinationsModel>pollen_quality}"
												tooltip="Pollen Quality: {ongoingPollinationsModel>pollen_quality}"
												design="StatusIconHidden"
												class="sapUiTinyMarginEnd"
												status="{=
													${ongoingPollinationsModel>pollen_quality} === 'good' ? 'Success' : 'Warning'
												}"
											/>
										</HBox>
									</VBox>
								</f:GridListItem>
							</f:GridList>
							<!-- @ui5ignore -->
							<html:hr>
								<!-- @ui5ignore -->
							</html:hr>
							<f:GridList
								id="pollinationsWithPlantingsList"
								items="{
									path: 'ongoingPollinationsModel>/',
									sorter: [{
										path: 'seed_capsule_plant_name',
										descending: true,
										group: '.getPollinationStatusGroup'
									}, {
										path: 'harvest_date',
										descending: false
									}],
									filters: [{
										path: 'pollination_status',
										operator: 'EQ',
										value1: 'seed'
									}, {
										path: 'pollination_status',
										operator: 'EQ',
										value1: 'germinated'
									}],
									and: false
								}"
								class="sapUiResponsiveContentPadding"
							>
								<f:customLayout>
									<grid:GridBasicLayout
										gridTemplateColumns="repeat(auto-fit, minmax(20rem, 21rem)
											)"
										gridGap="0.5rem"
									/>
								</f:customLayout>
								<core:Fragment
									fragmentName="pollination.ui.view.embedded.PollinationWithPlantingsTemplate"
									type="XML"
								/>
							</f:GridList>
						</VBox>
					</f:content>
				</f:DynamicPage>
			</content>
		</Page>
	</App>
</mvc:View>