{"version":3,"file":"App.controller.js","names":["browser","BaseController","formatter","ButtonType","DialogType","ValueState","App","onInit","getView","setModel","JSONModel","isMobile","mobile","_load_initial_data","_new_temp_pollination","pollinationTimestamp","format_timestamp","Date","location","oModel","_reset_temp_pollination_florescence","_reset_temp_pollination_pollen","_new_pollinations","florescenceId","undefined","florescencePlantName","florescencePlantId","florescenceStatus","availableColorsRgb","labelColorRgb","getModel","updateBindings","pollenDonorPlantName","pollenDonorPlantId","pollenType","_load_settings","_load_active_florescences","_load_ongoing_pollinations","$","ajax","url","getServiceUrl","data","context","async","done","_onDoneLoadSettings","fail","onFail","bind","result","_onDoneLoadActiveInflorescences","activeFlorescenceCollection","_onDoneLoadOngoingPollinations","oModelOngoingPollinations","ongoingPollinationCollection","setData","onSelectionChangedCurrentFlorescence","oEvent","florescence","getParameter","getBindingContext","getObject","id","_onDoneLoadPotentialPollenDonors","plant_name","plant_id","florescence_status","_getAvailableColors","availabeColorsRgb","JSON","parse","stringify","available_colors_rgb","i","length","pollination","iIndex","indexOf","splice","onSelectionChangedPollenDonor","pollenDonor","pollen_type","oNewTempPollinationModel","potentialPollenDonorCollection","getPollenTypeGroup","oContext","text","getProperty","toUpperCase","replace","getFlorescenceStatusGroup","getPollinationStatusGroup","getPollinationStatusComparator","a","b","orderMapping","scoreA","scoreB","getGenusGroup","onColorSelect","onPressAddButton","selectedFlorescenceItem","byId","getSelectedItem","MessageToast","show","selectedFlorescence","selectedPollenDonorItem","selectedPollenDonor","locationText","oNewPollination","seedCapsulePlantName","seedCapsulePlantId","push","_deleteNewPollination","index","onPressDeleteNewPollinationButton","getSource","onPressSaveNewPollinationButton","oNewPollinationsJson","type","contentType","_onDonePostNewPollination","onLiveChangeOngoingPollinationsFilter","aFilters","sQuery","getValue","filter","Filter","FilterOperator","Contains","EQ","oList","oBinding","getBinding","onPressEditActiveFlorescence","oCurrentFlorescence","oEditedFlorescence","flowers_count_known","flowers_count","branches_count_known","branches_count","inflorescence_appearance_date_known","inflorescence_appearance_date","first_flower_opening_date_known","first_flower_opening_date","last_flower_closing_date_known","last_flower_closing_date","oView","fn","oDialog","addDependent","oEditedFlorescenceModel","open","Fragment","load","name","getId","controller","then","onAfterCloseEditFlorescenceDialog","destroy","onPressEditFlorescenceSetToday","dateField","getData","toISOString","substring","onPressSubmitEditFlorescence","Error","oEditedFlorescenceJson","_onDonePutFlorescence","applyToFragment","o","close","onPressDeleteFlorescence","florescence_id","MessageBox","confirm","onClose","_onConfirmDeleteFlorescence","sAction","_deleteFlorescence","_onDoneDeleteFlorescence","onPressEditOngoingPollination","oOngoingPollination","oEditedPollination","pollination_timestamp_known","pollination_timestamp","harvest_date_known","harvest_date","oEditedPollinationModel","onAfterCloseEditPollinationDialog","onOpenColorPalettePopover","oButton","oSettingsModel","aColors","_oColorPalettePopoverMinDefautButton","ColorPalettePopover","showMoreColorsButton","colors","colorSelect","_onSelectColorInColorPalettePopover","openBy","setProperty","onChangeInputCalcGerminationRate","onChangeInputPreventNonInt","iSeedsSown","iSeedsGerminated","fGerminationRate","iGerminationRate","Math","round","onPressSubmitEditPollinationAndFinish","_onConfirmSubmitEditPollinationAndFinish","onPressSubmitEditPollination","setFinished","ongoing","oEditedPollinationJson","_onDonePutPollination","onPressDeletePollination","pollination_id","_onConfirmDeletePollination","_deletePollination","_onDoneDeletePollination","onPressOpenPollenContainersMaintenance","_onDoneGetPollenContainers","setSizeLimit","onAfterClosemaintainPollenContainers","onPressSubmitPollenContainers","oPollenContainersModel","oPollenContainersFull","oPollenContainers","pollenContainerCollection","oPollenContainersJson","_onDonePutPollenContainers","onPressAddPlantForPollenContainer","iCount","oPollenContainer","oPlant","oNewPollenContainerItem","genus","count_stored_pollen_containers","aPollenContainers","aPlantsWithoutPollenContainers","plantsWithoutPollenContainerCollection","clearSelection","onPressAddActiveFlorescence","_onDoneGetPlantsForNewFlorescence","oNewFlorescence","comment","oNewFlorescenceModel","plantsForNewFlorescenceCollection","onPressSubmitNewFlorescence","oNewFlorescenceJson","_onDonePostNewFlorescence","onAfterCloseAddActiveFlorescence","onPressRetrainProbabilityModelPollinationToSeed","_onDoneRetrainPollinationModel","oSuccessMessageDialog","_oSuccessMessageDialog","Dialog","Message","title","state","Success","content","Text","model","mean_f1_score","beginButton","Button","Emphasized","press"],"sources":["../../src/controller/App.controller.ts"],"sourcesContent":["import MessageBox from \"sap/m/MessageBox\";\r\nimport Event from \"sap/ui/base/Event\";\r\nimport JSONModel from \"sap/ui/model/json/JSONModel\";\r\nimport { browser } from \"sap/ui/Device\";\r\nimport BaseController from \"./BaseController\";\r\nimport MessageToast from \"sap/m/MessageToast\";\r\nimport FilterOperator from \"sap/ui/model/FilterOperator\";\r\nimport Filter from \"sap/ui/model/Filter\";\r\nimport Fragment from \"sap/ui/core/Fragment\";\r\nimport { Pollination, Florescence, RetrainPollinationModelResults, PollenDonor, NewPollenContainerItem, Plant } from \"../interfaces/entities\";\r\nimport Dialog from \"sap/m/Dialog\";\r\nimport List from \"sap/m/List\";\r\nimport ColorPalettePopover from \"sap/m/ColorPalettePopover\";\r\nimport formatter from \"../model/formatter\";\r\nimport Button from \"sap/m/Button\";\r\nimport { ButtonType, DialogType } from \"sap/m/library\";\r\nimport { ValueState } from \"sap/ui/core/library\";\r\nimport Text from \"sap/m/Text\";\r\nimport Context from \"sap/ui/model/Context\";\r\nimport StepInput from \"sap/m/StepInput\";\r\nimport ComboBox from \"sap/m/ComboBox\";\r\nimport GridList from \"sap/f/GridList\";\r\nimport ListBinding from \"sap/ui/model/ListBinding\";\r\nimport SearchField from \"sap/m/SearchField\";\r\n\r\n/**\r\n * @namespace pollination.ui.controller\r\n */\r\nexport default class App extends BaseController {\r\n\r\n\tprivate _new_temp_pollination: Pollination;\r\n\tprivate _new_pollinations: Pollination[]; // = [];\r\n\tprivate _oColorPalettePopoverMinDefautButton: ColorPalettePopover;\r\n\tprivate _oSuccessMessageDialog: Dialog;\r\n\tpublic formatter: formatter = new formatter();\r\n\r\n\tpublic onInit(): void {\r\n\r\n\t\tthis.getView().setModel(new JSONModel({\r\n\t\t\t// isMobile: Device.browser.mobile,\r\n\t\t\tisMobile: browser.mobile\r\n\t\t}), \"view\");\r\n\r\n\t\tthis._load_initial_data();\r\n\r\n\t\t// initialize empty model for new pollination\r\n\t\tthis._new_temp_pollination = {\r\n\t\t\tpollinationTimestamp: this.format_timestamp(new Date()),\r\n\t\t\tlocation: 'indoor_led'\r\n\t\t}\r\n\t\tvar oModel = new JSONModel(this._new_temp_pollination);\r\n\t\tthis.getView().setModel(oModel, \"newTempPollinationModel\");\r\n\t\tthis._reset_temp_pollination_florescence();\r\n\t\tthis._reset_temp_pollination_pollen();\r\n\r\n\t\t// initialize empty model for added, not yet saved new pollinations\r\n\t\tthis._new_pollinations = []\r\n\t\tvar oModel = new JSONModel(this._new_pollinations);\r\n\t\tthis.getView().setModel(oModel, \"newPollinationsModel\");\r\n\t}\r\n\r\n\tprivate _reset_temp_pollination_florescence() {\r\n\t\tthis._new_temp_pollination.florescenceId = undefined;\r\n\t\tthis._new_temp_pollination.florescencePlantName = undefined;\r\n\t\tthis._new_temp_pollination.florescencePlantId = undefined;\r\n\t\tthis._new_temp_pollination.florescenceStatus = undefined;\r\n\t\tthis._new_temp_pollination.availableColorsRgb = ['transparent', 'black'];  // technically required placeholders\r\n\t\tthis._new_temp_pollination.labelColorRgb = \"transparent\";\r\n\t\t(<JSONModel>this.getView().getModel('newTempPollinationModel')).updateBindings(false);\r\n\t}\r\n\r\n\tprivate _reset_temp_pollination_pollen() {\r\n\t\tthis._new_temp_pollination.pollenDonorPlantName = undefined;\r\n\t\tthis._new_temp_pollination.pollenDonorPlantId = undefined;\r\n\t\tthis._new_temp_pollination.pollenType = undefined;\r\n\t\t(<JSONModel>this.getView().getModel('newTempPollinationModel')).updateBindings(false);\r\n\t}\r\n\r\n\tprivate _load_initial_data() {\r\n\t\t// load only once\r\n\t\tthis._load_settings();\r\n\r\n\t\t// triggered at other places, too\r\n\t\tthis._load_active_florescences();\r\n\t\tthis._load_ongoing_pollinations();\r\n\t}\r\n\r\n\tprivate _load_settings() {\r\n\t\t$.ajax({\r\n\t\t\turl: this.getServiceUrl('pollinations/settings'),\r\n\t\t\tdata: {},\r\n\t\t\tcontext: this,\r\n\t\t\tasync: true\r\n\t\t})\r\n\t\t\t.done(this._onDoneLoadSettings)\r\n\t\t\t.fail(this.onFail.bind(this, 'Load settings'))\r\n\t}\r\n\r\n\tprivate _onDoneLoadSettings(result: any) {\r\n\t\tvar oModel = new JSONModel(result);\r\n\t\tthis.getView().setModel(oModel, \"settingsModel\");\r\n\t}\r\n\r\n\tprivate _load_active_florescences() {\r\n\t\t$.ajax({\r\n\t\t\turl: this.getServiceUrl('active_florescences'),\r\n\t\t\tdata: {},\r\n\t\t\tcontext: this,\r\n\t\t\tasync: true\r\n\t\t})\r\n\t\t\t.done(this._onDoneLoadActiveInflorescences)\r\n\t\t\t.fail(this.onFail.bind(this, 'Load current florescences'))\r\n\t}\r\n\r\n\tprivate _onDoneLoadActiveInflorescences(result: any) {\r\n\t\tvar oModel = new JSONModel(result.activeFlorescenceCollection);\r\n\t\tthis.getView().setModel(oModel, \"currentFlorescencesModel\");\r\n\r\n\t\tthis._reset_temp_pollination_florescence();\r\n\t}\r\n\r\n\tprivate _load_ongoing_pollinations() {\r\n\r\n\t\t$.ajax({\r\n\t\t\turl: this.getServiceUrl('ongoing_pollinations'),\r\n\t\t\tdata: {},\r\n\t\t\tcontext: this,\r\n\t\t\tasync: true\r\n\t\t})\r\n\t\t\t.done(this._onDoneLoadOngoingPollinations)\r\n\t\t\t.fail(this.onFail.bind(this, 'Load ongoing pollinations'))\r\n\t}\r\n\r\n\tprivate _onDoneLoadOngoingPollinations(result: any) {\r\n\t\tvar oModelOngoingPollinations = <JSONModel>this.getView().getModel(\"ongoingPollinationsModel\");\r\n\t\tif (!oModelOngoingPollinations) {\r\n\t\t\tvar oModelOngoingPollinations = new JSONModel(result.ongoingPollinationCollection);\r\n\t\t\tthis.getView().setModel(oModelOngoingPollinations, \"ongoingPollinationsModel\");\r\n\t\t} else {\r\n\t\t\t(<JSONModel>oModelOngoingPollinations).setData(result.ongoingPollinationCollection);\r\n\t\t}\r\n\t}\r\n\r\n\tpublic onSelectionChangedCurrentFlorescence(oEvent: Event) {\r\n\t\tvar florescence: Florescence = oEvent.getParameter('listItem').getBindingContext('currentFlorescencesModel').getObject();\r\n\t\t// var plant_id = florescence.id;\r\n\t\t$.ajax({\r\n\t\t\turl: this.getServiceUrl('potential_pollen_donors/' + florescence.id),\r\n\t\t\tdata: {},\r\n\t\t\tcontext: this,\r\n\t\t\tasync: true\r\n\t\t})\r\n\t\t\t.done(this._onDoneLoadPotentialPollenDonors)\r\n\t\t\t.fail(this.onFail.bind(this, 'Load potential pollen donors'))\r\n\r\n\t\t// set selected florescence plant in new pollination temp model \r\n\t\tthis._new_temp_pollination.florescencePlantName = florescence.plant_name;\r\n\t\tthis._new_temp_pollination.florescencePlantId = florescence.plant_id;\r\n\t\tthis._new_temp_pollination.florescenceId = florescence.id;\r\n\t\tthis._new_temp_pollination.florescenceStatus = florescence.florescence_status;  // for enabling/disabling preview button\r\n\r\n\t\t// update the available colors for the florescence\r\n\t\tthis._new_temp_pollination.availableColorsRgb = this._getAvailableColors(florescence);\r\n\t\t(<JSONModel>this.getView().getModel(\"newTempPollinationModel\")).updateBindings(false);\r\n\t}\r\n\r\n\tprivate _getAvailableColors(florescence: Florescence) {\r\n\t\t// determine available colors based on the colors we received from backend for the currently selected\r\n\t\t// florescence and the colors we already used for unsaved pollinations \r\n\r\n\t\t// clone available colors from those we received from backend so we don't modify the original below\r\n\t\tvar availabeColorsRgb = JSON.parse(JSON.stringify(florescence.available_colors_rgb));\r\n\r\n\t\t// remove colors from unsaved pollinations\r\n\t\tfor (var i = 0; i < this._new_pollinations.length; i++) {\r\n\t\t\tvar pollination = this._new_pollinations[i];\r\n\t\t\tif (this._new_temp_pollination.florescenceId === pollination.florescenceId) {\r\n\t\t\t\tvar iIndex = availabeColorsRgb.indexOf(pollination.labelColorRgb);\r\n\t\t\t\tif (iIndex >= 0) {\r\n\t\t\t\t\tavailabeColorsRgb.splice(iIndex, 1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn availabeColorsRgb;\r\n\t}\r\n\r\n\tpublic onSelectionChangedPollenDonor(oEvent: Event) {\r\n\t\tvar pollenDonor = oEvent.getParameter('listItem').getBindingContext('potentialPollenDonorsModel').getObject();\r\n\r\n\t\tthis._new_temp_pollination.pollenDonorPlantName = pollenDonor.plant_name;\r\n\t\tthis._new_temp_pollination.pollenDonorPlantId = pollenDonor.plant_id;\r\n\t\tthis._new_temp_pollination.pollenType = pollenDonor.pollen_type;\r\n\t\tvar oNewTempPollinationModel = this.getView().getModel(\"newTempPollinationModel\");\r\n\t\t(<JSONModel>oNewTempPollinationModel).updateBindings(false);\r\n\t}\r\n\r\n\tprivate _onDoneLoadPotentialPollenDonors(result: any) {\r\n\t\tvar oModel = new JSONModel(result.potentialPollenDonorCollection);\r\n\t\tthis.getView().setModel(oModel, \"potentialPollenDonorsModel\");\r\n\r\n\t\tthis._reset_temp_pollination_pollen();\r\n\t}\r\n\r\n\tpublic getPollenTypeGroup(oContext: Context) {\r\n\t\t//grouper for Pollen Type\r\n\t\tconst text = oContext.getProperty('pollen_type') + ' Pollen'\r\n\t\treturn text.toUpperCase().replace('_', ' ');\r\n\t}\r\n\r\n\tpublic getFlorescenceStatusGroup(oContext: Context) {\r\n\t\treturn oContext.getProperty('florescence_status').toUpperCase().replace('_', ' ');\r\n\t}\r\n\r\n\tpublic getPollinationStatusGroup(oContext: Context) {\r\n\t\t// we can't change order here, only format the group text\r\n\t\treturn oContext.getProperty('pollination_status').toUpperCase().replace('_', ' ');\r\n\t}\r\n\r\n\tpublic getPollinationStatusComparator(a: string, b: string) {\r\n\t\t//receives the results of getPollinationStatusGroup for two items as inputs\r\n\t\t//return numbered output for custom sorting\r\n\t\t//cf sap.ui.model.Sorter.defaultComparator\r\n\t\tconst orderMapping: any = {\r\n\t\t\t'ATTEMPT': 1,\r\n\t\t\t'SEED_CAPSULE': 2,\r\n\t\t\t'GERMINATED': 3\r\n\t\t};\r\n\t\tconst scoreA = orderMapping[a];\r\n\t\tconst scoreB = orderMapping[b];\r\n\r\n\t\tif (scoreA < scoreB) {\r\n\t\t\treturn -1;\r\n\t\t} else {\r\n\t\t\treturn 1;\r\n\t\t}\r\n\t}\r\n\r\n\tpublic getGenusGroup(oContext: Context) {\r\n\t\treturn oContext.getProperty('genus');\r\n\t}\r\n\r\n\tpublic onColorSelect(oEvent: Event) {\r\n\t\tthis._new_temp_pollination.labelColorRgb = oEvent.getParameter('value');\r\n\t\tvar oNewTempPollinationModel = <JSONModel>this.getView().getModel(\"newTempPollinationModel\");\r\n\t\toNewTempPollinationModel.updateBindings(false);\r\n\t}\r\n\r\n\tpublic onPressAddButton(oEvent: Event) {\r\n\t\tvar selectedFlorescenceItem = (<List>this.getView().byId('activeFlorescencesList')).getSelectedItem();\r\n\t\tif (selectedFlorescenceItem === null || selectedFlorescenceItem === undefined) {\r\n\t\t\tMessageToast.show('Please select a florescence.')\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar selectedFlorescence = <Florescence>selectedFlorescenceItem.getBindingContext('currentFlorescencesModel')!.getObject();\r\n\r\n\t\tvar selectedPollenDonorItem = (<List>this.getView().byId('potentialPollenDonorsList')).getSelectedItem();\r\n\t\tvar selectedPollenDonor = <PollenDonor>selectedPollenDonorItem.getBindingContext('potentialPollenDonorsModel')!.getObject();\r\n\r\n\t\t// var oNewTempPollinationModel = this.getView().getModel(\"newTempPollinationModel\");\r\n\t\t// var oNewTempPollination = oNewTempPollinationModel.getData();\r\n\t\tif (this._new_temp_pollination.florescencePlantName !== selectedFlorescence.plant_name\r\n\t\t\t|| this._new_temp_pollination.pollenDonorPlantName !== selectedPollenDonor.plant_name) {\r\n\t\t\tMessageToast.show('Bad Plant Names.')\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tswitch (this._new_temp_pollination.location) {\r\n\t\t\tcase 'indoor_led': var locationText = 'indoor LED'; break;\r\n\t\t\tcase 'indoor': var locationText = 'indoor'; break;\r\n\t\t\tcase 'outdoor': var locationText = 'outdoor'; break;\r\n\t\t\tdefault:\r\n\t\t\t\tMessageToast.show('Bad Location.')\r\n\t\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (!this._new_temp_pollination.labelColorRgb || this._new_temp_pollination.labelColorRgb === '' || this._new_temp_pollination.labelColorRgb === 'transparent') {\r\n\t\t\tMessageToast.show('Choose Color first.')\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// add new pollination to the newPollinationsModel\r\n\t\tvar oNewPollination = {\r\n\t\t\tflorescenceId: this._new_temp_pollination.florescenceId,\r\n\t\t\tseedCapsulePlantName: selectedFlorescence.plant_name,\r\n\t\t\tseedCapsulePlantId: selectedFlorescence.plant_id,\r\n\t\t\tpollenDonorPlantName: selectedPollenDonor.plant_name,\r\n\t\t\tpollenDonorPlantId: selectedPollenDonor.plant_id,\r\n\t\t\tpollenType: this._new_temp_pollination.pollenType,\r\n\t\t\tpollinationTimestamp: this._new_temp_pollination.pollinationTimestamp,  // '%Y-%m-%d %H:%M' without seconds\r\n\t\t\tlocation: this._new_temp_pollination.location,\r\n\t\t\tlocationText: locationText,\r\n\t\t\tlabelColorRgb: this._new_temp_pollination.labelColorRgb\r\n\t\t}\r\n\t\tthis._new_pollinations.push(oNewPollination);\r\n\t\t(<JSONModel>this.getView().getModel(\"newPollinationsModel\")).updateBindings(false);\r\n\r\n\t\t// remove label color from available colors for this florescence\r\n\t\tthis._new_temp_pollination.labelColorRgb = 'transparent';\r\n\t\tthis._new_temp_pollination.availableColorsRgb = this._getAvailableColors(selectedFlorescence);\r\n\t\t(<JSONModel>this.getView().getModel(\"newTempPollinationModel\")).updateBindings(false);\r\n\t}\r\n\r\n\tprivate _deleteNewPollination(oNewPollination: Pollination) {\r\n\t\tvar index = this._new_pollinations.indexOf(oNewPollination);\r\n\t\tthis._new_pollinations.splice(index, 1);\r\n\t\t(<JSONModel>this.getView().getModel(\"newPollinationsModel\")).updateBindings(false);\r\n\t}\r\n\r\n\tpublic onPressDeleteNewPollinationButton(oEvent: Event) {\r\n\t\tvar oNewPollination = <Pollination>(<Button>oEvent.getSource()).getBindingContext(\"newPollinationsModel\")!.getObject();  // todo type\r\n\t\tthis._deleteNewPollination(oNewPollination);\r\n\t}\r\n\r\n\tpublic onPressSaveNewPollinationButton(oEvent: Event) {\r\n\t\tvar oNewPollination = <Pollination>(<Button>oEvent.getSource()).getBindingContext(\"newPollinationsModel\")!.getObject();  // todo type\r\n\t\tvar oNewPollinationsJson = JSON.stringify(oNewPollination);\r\n\t\t$.ajax({\r\n\t\t\turl: this.getServiceUrl('pollinations'),\r\n\t\t\tdata: oNewPollinationsJson,\r\n\t\t\tcontext: this,\r\n\t\t\tasync: true,\r\n\t\t\ttype: 'POST',\r\n\t\t\tcontentType: 'application/json'\r\n\t\t})\r\n\t\t\t.done(this._onDonePostNewPollination.bind(this, oNewPollination))\r\n\t\t\t.fail(this.onFail.bind(this, 'Save new pollinations'))\r\n\t}\r\n\r\n\tprivate _onDonePostNewPollination(oNewPollination: Pollination) {\r\n\t\t// having posted a new pollination, re-read the ongoing pollinations list\r\n\t\tthis._load_ongoing_pollinations();\r\n\r\n\t\t// also re-read the active florescences list\r\n\t\tthis._load_active_florescences();\r\n\r\n\t\t// remove saved new pollination from new pollinations model \r\n\t\tthis.getView().getModel(\"newPollinationsModel\")\r\n\t\tthis._deleteNewPollination(oNewPollination);\r\n\t}\r\n\r\n\tpublic onLiveChangeOngoingPollinationsFilter(oEvent: Event) {\r\n\t\t// add filter to ongoing pollinations gridlist\r\n\t\tvar aFilters = [];\r\n\t\tvar sQuery = (<SearchField>oEvent.getSource()).getValue();\r\n\t\tif (sQuery && sQuery.length > 0) {\r\n\t\t\t// var filter = new Filter(\"seed_capsule_plant_name\", FilterOperator.Contains, sQuery);\r\n\t\t\t// filter on multiple fields, connected with OR\r\n\t\t\tvar filter = new Filter([\r\n\t\t\t\tnew Filter(\"seed_capsule_plant_name\", FilterOperator.Contains, sQuery),\r\n\t\t\t\tnew Filter(\"pollen_donor_plant_name\", FilterOperator.Contains, sQuery),\r\n\t\t\t\tnew Filter(\"seed_capsule_plant_id\", FilterOperator.EQ, sQuery),\r\n\t\t\t\tnew Filter(\"pollen_donor_plant_id\", FilterOperator.EQ, sQuery),\r\n\t\t\t\tnew Filter(\"pollination_timestamp\", FilterOperator.Contains, sQuery),\r\n\t\t\t\tnew Filter(\"pollen_type\", FilterOperator.Contains, sQuery),\r\n\t\t\t], false);\r\n\t\t\taFilters.push(filter);\r\n\t\t}\r\n\r\n\t\t// update list binding\r\n\t\tvar oList = <GridList>this.byId(\"ongoingPollinationsList\");\r\n\t\tvar oBinding = <ListBinding>oList.getBinding(\"items\");\r\n\t\toBinding.filter(aFilters, \"Application\");\r\n\t}\r\n\r\n\r\n\t////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n\t//\t\tedit florescence\r\n\t////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n\tpublic onPressEditActiveFlorescence(oEvent: Event) {\r\n\t\t// clone active florescence object for manipulation in the dialog\r\n\t\tvar oCurrentFlorescence = (<Button>oEvent.getSource()).getBindingContext(\"currentFlorescencesModel\")!.getObject();\r\n\t\tvar oEditedFlorescence = JSON.parse(JSON.stringify(oCurrentFlorescence));\r\n\r\n\t\t// add some control attributes to allow for usage of sliders and keeping undefined values\r\n\t\toEditedFlorescence.flowers_count_known = !!oEditedFlorescence.flowers_count\r\n\t\toEditedFlorescence.branches_count_known = !!oEditedFlorescence.branches_count\r\n\t\toEditedFlorescence.inflorescence_appearance_date_known = !!oEditedFlorescence.inflorescence_appearance_date\r\n\t\toEditedFlorescence.first_flower_opening_date_known = !!oEditedFlorescence.first_flower_opening_date\r\n\t\toEditedFlorescence.last_flower_closing_date_known = !!oEditedFlorescence.last_flower_closing_date\r\n\r\n\t\t// // open dialog and bind model\r\n\t\t// this.applyToFragment('editFlorescence',(o)=>{asdf\r\n\t\t// \tvar oEditedFlorescenceModel = new sap.ui.model.json.JSONModel(oEditedFlorescence);\r\n\t\t// \tthis.getView().setModel(oEditedFlorescenceModel, \"editedFlorescenceModel\");\r\n\t\t// \to.open();\r\n\t\t// }, undefined);\r\n\r\n\t\t// open dialog\r\n\t\tvar oView = this.getView();\r\n\t\tvar fn = (oDialog: any) => {\r\n\t\t\toView.addDependent(oDialog);  // required to bind fragment to view\r\n\t\t\tvar oEditedFlorescenceModel = new JSONModel(oEditedFlorescence);\r\n\t\t\toView.setModel(oEditedFlorescenceModel, \"editedFlorescenceModel\");\r\n\t\t\toDialog.open();\r\n\t\t};\r\n\t\tif (!this.byId('editedFlorescenceModel')) {\r\n\t\t\tFragment.load({\r\n\t\t\t\tname: \"pollination.ui.view.fragments.EditFlorescence\",\r\n\t\t\t\tid: oView.getId(),\r\n\t\t\t\tcontroller: this\r\n\t\t\t}).then(fn);\r\n\t\t} else {\r\n\t\t\tfn(<Dialog>this.byId('editedFlorescenceModel'));\r\n\t\t}\r\n\t}\r\n\r\n\tpublic onAfterCloseEditFlorescenceDialog(oEvent: Event) {\r\n\t\t// destroy model and fragment, works for both regular closing and hitting ESC\r\n\t\tvar oDialog = oEvent.getSource();\r\n\t\toDialog.destroy();\r\n\t\tthis.getView().getModel(\"editedFlorescenceModel\").destroy();\r\n\t}\r\n\r\n\tpublic onPressEditFlorescenceSetToday(dateField: string) {\r\n\t\tvar oEditedFlorescenceModel = <JSONModel>this.getView().getModel(\"editedFlorescenceModel\");\r\n\t\tvar oEditedFlorescence = oEditedFlorescenceModel.getData();\r\n\t\toEditedFlorescence[dateField] = (new Date()).toISOString().substring(0, 10);  // e.g. '2022-11-17';\r\n\t\toEditedFlorescenceModel.updateBindings(false);\r\n\t}\r\n\r\n\tpublic onPressSubmitEditFlorescence(oEvent: Event) {\r\n\t\tvar oEditedFlorescenceModel = <JSONModel>this.getView().getModel(\"editedFlorescenceModel\");\r\n\t\tvar oEditedFlorescence = oEditedFlorescenceModel.getData();\r\n\r\n\t\t// the inputs are bound to the model and might update undefined values to default values\r\n\t\t// we need to set them back to undefined\r\n\t\tif (!oEditedFlorescence.branches_count_known) {\r\n\t\t\toEditedFlorescence.branches_count = undefined;\r\n\t\t}\r\n\t\tif (!oEditedFlorescence.flowers_count_known) {\r\n\t\t\toEditedFlorescence.flowers_count = undefined;\r\n\t\t}\r\n\t\tif (!oEditedFlorescence.inflorescence_appearance_date_known) {\r\n\t\t\toEditedFlorescence.inflorescence_appearance_date = undefined;\r\n\t\t}\r\n\t\tif (!oEditedFlorescence.first_flower_opening_date_known) {\r\n\t\t\toEditedFlorescence.first_flower_opening_date = undefined;\r\n\t\t}\r\n\t\tif (!oEditedFlorescence.last_flower_closing_date_known) {\r\n\t\t\toEditedFlorescence.last_flower_closing_date = undefined;\r\n\t\t}\r\n\r\n\t\t// depending on florescence status, we might set some dates to undefined\r\n\t\t// todo better validate and cancel with message\r\n\t\tif (oEditedFlorescence.florescence_status === \"inflorescence_appeared\") {\r\n\t\t\toEditedFlorescence.first_flower_opening_date = undefined;\r\n\t\t\toEditedFlorescence.last_flower_closing_date = undefined;\r\n\t\t} else if (oEditedFlorescence.florescence_status === \"flowering\") {\r\n\t\t\toEditedFlorescence.last_flower_closing_date = undefined;\r\n\t\t} else if (oEditedFlorescence.florescence_status === \"finished\") {\r\n\t\t\t// nothing to do\r\n\t\t} else {\r\n\t\t\tthrow new Error(\"Unknown florescence status: \" + oEditedFlorescence.florescence_status);\r\n\t\t}\r\n\r\n\t\tvar oEditedFlorescenceJson = JSON.stringify(oEditedFlorescence);\r\n\t\t$.ajax({\r\n\t\t\turl: this.getServiceUrl('active_florescences/' + oEditedFlorescence.id),\r\n\t\t\tdata: oEditedFlorescenceJson,\r\n\t\t\tcontext: this,\r\n\t\t\tasync: true,\r\n\t\t\ttype: 'PUT',\r\n\t\t\tcontentType: 'application/json'\r\n\t\t})\r\n\t\t\t.done(this._onDonePutFlorescence)\r\n\t\t\t.fail(this.onFail.bind(this, 'Update florescence'))\r\n\t}\r\n\r\n\tprivate _onDonePutFlorescence() {\r\n\t\tthis.applyToFragment('editFlorescence', (o: any) => {\r\n\t\t\to.close();\r\n\t\t});\r\n\t\tthis._load_active_florescences();\r\n\t}\r\n\r\n\tpublic onPressDeleteFlorescence(oEvent: Event) {\r\n\t\tvar florescence_id = (<JSONModel>this.getView().getModel(\"editedFlorescenceModel\")).getData().id;\r\n\t\tMessageBox.confirm(\"Really delete Florescence? This cannot be undone.\",\r\n\t\t\t{ onClose: this._onConfirmDeleteFlorescence.bind(this, florescence_id) }\r\n\t\t);\r\n\t}\r\n\r\n\tprivate _onConfirmDeleteFlorescence(florescence_id: int, sAction: string) {\r\n\t\tif (sAction === \"OK\") {\r\n\t\t\tthis._deleteFlorescence(florescence_id);\r\n\t\t} else {\r\n\t\t\t// do nothing\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _deleteFlorescence(florescence_id: int) {\r\n\t\t$.ajax({\r\n\t\t\turl: this.getServiceUrl('florescences/' + florescence_id),\r\n\t\t\tcontext: this,\r\n\t\t\tasync: true,\r\n\t\t\ttype: 'DELETE',\r\n\t\t\tcontentType: 'application/json'\r\n\t\t})\r\n\t\t\t.done(this._onDoneDeleteFlorescence)\r\n\t\t\t.fail(this.onFail.bind(this, 'Delete florescences'))\r\n\t}\r\n\r\n\tprivate _onDoneDeleteFlorescence() {\r\n\t\tthis.applyToFragment('editFlorescence', (o: Dialog) => {\r\n\t\t\to.close();\r\n\t\t});\r\n\r\n\t\tthis._load_active_florescences();\r\n\t}\r\n\r\n\t////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n\t// \t\teditPollination\r\n\t////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n\tpublic onPressEditOngoingPollination(oEvent: Event) {\r\n\t\t// clone ongoing pollination object for manipulation in the dialog\r\n\t\tvar oOngoingPollination = (<Button>oEvent.getSource()).getBindingContext(\"ongoingPollinationsModel\")!.getObject();\r\n\t\tvar oEditedPollination = JSON.parse(JSON.stringify(oOngoingPollination));\r\n\r\n\t\t// add some control attributes to allow for usage of sliders and keeping undefined values\r\n\t\toEditedPollination.pollination_timestamp_known = !!oEditedPollination.pollination_timestamp\r\n\t\toEditedPollination.harvest_date_known = !!oEditedPollination.harvest_date\r\n\r\n\t\t// // open dialog and bind model\r\n\t\t// this.applyToFragment('editPollination',(o)=>{\r\n\t\t// \tvar oEditedPollinationModel = new sap.ui.model.json.JSONModel(oEditedPollination);\r\n\t\t// \tthis.getView().setModel(oEditedPollinationModel, \"editedPollinationModel\");\r\n\t\t// \to.open();\r\n\t\t// });\r\n\r\n\t\tvar oView = this.getView();\r\n\t\tvar fn = (o: any) => {\r\n\t\t\toView.addDependent(o);  // required to bind fragment to view\r\n\t\t\tvar oEditedPollinationModel = new JSONModel(oEditedPollination);\r\n\t\t\toView.setModel(oEditedPollinationModel, \"editedPollinationModel\");\r\n\t\t\to.open();\r\n\t\t};\r\n\r\n\t\t// open dialog\r\n\t\tif (!this.byId('editPollination')) {\r\n\t\t\tFragment.load({\r\n\t\t\t\tname: \"pollination.ui.view.fragments.EditPollination\",\r\n\t\t\t\tid: this.getView().getId(),\r\n\t\t\t\tcontroller: this\r\n\t\t\t}).then(fn);\r\n\t\t} else {\r\n\t\t\tfn(this.byId('editPollination'));\r\n\t\t}\r\n\t}\r\n\r\n\tpublic onAfterCloseEditPollinationDialog(oEvent: Event) {\r\n\t\t// destroy model and fragment, works for both regular closing and hitting ESC\r\n\t\tvar oDialog = oEvent.getSource();\r\n\t\toDialog.destroy();\r\n\t\tthis.getView().getModel(\"editedPollinationModel\").destroy();\r\n\t}\r\n\r\n\tpublic onOpenColorPalettePopover(oEvent: Event) {\r\n\t\tconst oButton = <Button>oEvent.getSource()\r\n\t\t// read colors from settings model\r\n\t\tvar oSettingsModel = this.getView().getModel(\"settingsModel\");\r\n\t\tvar aColors = oSettingsModel.getProperty(\"/colors\");\r\n\r\n\t\t// open popover and set colors\r\n\t\tif (!this._oColorPalettePopoverMinDefautButton) {\r\n\t\t\tthis._oColorPalettePopoverMinDefautButton = new ColorPalettePopover(\"oColorPalettePopoverMinDef\", {\r\n\t\t\t\tshowMoreColorsButton: false,\r\n\t\t\t\tcolors: aColors,\r\n\t\t\t\tcolorSelect: this._onSelectColorInColorPalettePopover.bind(this)\r\n\t\t\t});\r\n\t\t}\r\n\t\t// @ts-ignore  typescript data definitions for sap.m.ColorPalette are missing .openBy()\r\n\t\tthis._oColorPalettePopoverMinDefautButton.openBy(oButton);\r\n\t}\r\n\r\n\tprivate _onSelectColorInColorPalettePopover(oEvent: Event) {\r\n\t\t// update color in model\r\n\t\tvar oEditedPollinationModel = <JSONModel>this.getView().getModel(\"editedPollinationModel\");\r\n\t\toEditedPollinationModel.setProperty(\"/label_color_rgb\", oEvent.getParameter(\"value\"));\r\n\t\toEditedPollinationModel.updateBindings(false);\r\n\t}\r\n\r\n\tpublic onChangeInputCalcGerminationRate(oEvent: Event) {\r\n\t\t// upon changing # seeds sown or # seeds germinated, re-calculates germination rate\r\n\r\n\t\t// apply our default validator for int input\r\n\t\tthis.onChangeInputPreventNonInt(oEvent);\r\n\r\n\t\t// get values and calculate germination rate\r\n\t\tvar oEditedPollinationModel = <JSONModel>this.getView().getModel(\"editedPollinationModel\");\r\n\t\tvar iSeedsSown = oEditedPollinationModel.getProperty(\"/first_seeds_sown\");\r\n\t\tvar iSeedsGerminated = oEditedPollinationModel.getProperty(\"/first_seeds_germinated\");\r\n\t\tif (iSeedsSown && iSeedsGerminated) {\r\n\t\t\tvar fGerminationRate = iSeedsGerminated / iSeedsSown * 100;\r\n\t\t\tvar iGerminationRate = Math.round(fGerminationRate);\r\n\t\t\toEditedPollinationModel.setProperty(\"/germination_rate\", iGerminationRate);\r\n\t\t}\r\n\t\toEditedPollinationModel.updateBindings(false);\r\n\r\n\t}\r\n\r\n\tpublic onPressSubmitEditPollinationAndFinish(oEvent: Event) {\r\n\t\tMessageBox.confirm(\"Finish Pollination? This will remove it from the list and cannot be undone.\",\r\n\t\t\t{ onClose: this._onConfirmSubmitEditPollinationAndFinish.bind(this) }\r\n\t\t);\r\n\t}\r\n\r\n\tprivate _onConfirmSubmitEditPollinationAndFinish(sAction: string) {\r\n\t\tif (sAction === \"OK\") {\r\n\t\t\tthis.onPressSubmitEditPollination(true);\r\n\t\t} else {\r\n\t\t\t// do nothing\r\n\t\t}\r\n\t}\r\n\r\n\tpublic onPressSubmitEditPollination(setFinished: boolean) {\r\n\t\tvar oEditedPollinationModel = <JSONModel>this.getView().getModel(\"editedPollinationModel\");\r\n\t\tvar oEditedPollination = oEditedPollinationModel.getData();\r\n\r\n\t\t// the inputs are bound to the model and might update undefined values to default values\r\n\t\t// we need to set them back to undefined\r\n\t\tif (!oEditedPollination.pollination_timestamp_known) {\r\n\t\t\toEditedPollination.pollination_timestamp = undefined;\r\n\t\t}\r\n\t\tif (!oEditedPollination.harvest_date_known) {\r\n\t\t\toEditedPollination.harvest_date = undefined;\r\n\t\t}\r\n\r\n\t\t// set finished if confirmed\r\n\t\tif (setFinished === true) {\r\n\t\t\toEditedPollination.ongoing = false;\r\n\t\t}\r\n\r\n\t\t// todo validate status with certain inputs and cancel with message\r\n\r\n\t\tvar oEditedPollinationJson = JSON.stringify(oEditedPollination);\r\n\t\t$.ajax({\r\n\t\t\turl: this.getServiceUrl('pollinations/' + oEditedPollination.id),\r\n\t\t\tdata: oEditedPollinationJson,\r\n\t\t\tcontext: this,\r\n\t\t\tasync: true,\r\n\t\t\ttype: 'PUT',\r\n\t\t\tcontentType: 'application/json'\r\n\t\t})\r\n\t\t\t.done(this._onDonePutPollination)\r\n\t\t\t.fail(this.onFail.bind(this, 'Update pollination'))\r\n\t}\r\n\r\n\tprivate _onDonePutPollination() {\r\n\t\tthis.applyToFragment('editPollination', (o: Dialog) => {\r\n\t\t\to.close();\r\n\t\t});\r\n\r\n\t\tthis._load_active_florescences();\r\n\t\tthis._load_ongoing_pollinations();\r\n\t}\r\n\r\n\tpublic onPressDeletePollination(oEvent: Event) {\r\n\t\tvar pollination_id = (<JSONModel>this.getView().getModel(\"editedPollinationModel\")).getData().id;\r\n\t\tMessageBox.confirm(\"Really delete Pollination? This cannot be undone.\",\r\n\t\t\t{ onClose: this._onConfirmDeletePollination.bind(this, pollination_id) }\r\n\t\t);\r\n\t}\r\n\r\n\tprivate _onConfirmDeletePollination(pollination_id: int, sAction: string) {\r\n\t\tif (sAction === \"OK\") {\r\n\t\t\tthis._deletePollination(pollination_id);\r\n\t\t} else {\r\n\t\t\t// do nothing\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _deletePollination(pollination_id: int) {\r\n\t\t$.ajax({\r\n\t\t\turl: this.getServiceUrl('pollinations/' + pollination_id),\r\n\t\t\tcontext: this,\r\n\t\t\tasync: true,\r\n\t\t\ttype: 'DELETE',\r\n\t\t\tcontentType: 'application/json'\r\n\t\t})\r\n\t\t\t.done(this._onDoneDeletePollination)\r\n\t\t\t.fail(this.onFail.bind(this, 'Delete pollination'))\r\n\t}\r\n\r\n\tprivate _onDoneDeletePollination() {\r\n\t\tthis.applyToFragment('editPollination', (o: Dialog) => {\r\n\t\t\to.close();\r\n\t\t});\r\n\r\n\t\tthis._load_active_florescences();\r\n\t\tthis._load_ongoing_pollinations();\r\n\t}\r\n\r\n\r\n\t////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n\t// \t\tpollen containers maintenance\r\n\t////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n\tpublic onPressOpenPollenContainersMaintenance(oEvent: Event) {\r\n\t\t// query pollen containers from backend and open dialog for maintenance\r\n\t\t$.ajax({\r\n\t\t\turl: this.getServiceUrl('pollen_containers'),\r\n\t\t\tcontext: this,\r\n\t\t\tasync: true,\r\n\t\t\tcontentType: 'application/json'\r\n\t\t})\r\n\t\t\t.done(this._onDoneGetPollenContainers)\r\n\t\t\t.fail(this.onFail.bind(this, 'Get pollen containers'))\r\n\r\n\t\t// // open dialog\r\n\t\t// this.applyToFragment('maintainPollenContainers',(o)=>{\r\n\t\t// \to.open();\t\t\t\r\n\t\t// } undefined)\r\n\r\n\t\t// open dialog\r\n\t\tvar oView = this.getView();\r\n\t\tif (!this.byId('maintainPollenContainers')) {\r\n\t\t\tFragment.load({\r\n\t\t\t\tname: \"pollination.ui.view.fragments.MaintainPollenContainers\",\r\n\t\t\t\tid: oView.getId(),\r\n\t\t\t\tcontroller: this\r\n\t\t\t}).then((oDialog: any) => {\r\n\t\t\t\toView.addDependent(oDialog);\r\n\t\t\t\toDialog.open();\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\t(<Dialog>this.byId('maintainPollenContainers')).open();\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tprivate _onDoneGetPollenContainers(result: any) {\r\n\t\tvar oModel = new JSONModel(result);\r\n\t\toModel.setSizeLimit(2000);\r\n\t\tthis.getView().setModel(oModel, \"pollenContainersModel\");\r\n\t}\r\n\r\n\tpublic onAfterClosemaintainPollenContainers(oEvent: Event) {\r\n\t\tvar oDialog = oEvent.getSource();\r\n\t\toDialog.destroy();\r\n\t\tthis.getView().getModel(\"pollenContainersModel\").destroy();\r\n\t}\r\n\r\n\tpublic onPressSubmitPollenContainers(oEvent: Event) {\r\n\t\tvar oPollenContainersModel = <JSONModel>this.getView().getModel(\"pollenContainersModel\");\r\n\t\tvar oPollenContainersFull = oPollenContainersModel.getData();\r\n\r\n\t\t//we only send the pollen containers, not the list of plants that have none\r\n\t\tvar oPollenContainers = {\r\n\t\t\t\"pollenContainerCollection\": oPollenContainersFull.pollenContainerCollection\r\n\t\t}\r\n\r\n\t\tvar oPollenContainersJson = JSON.stringify(oPollenContainers);\r\n\t\t$.ajax({\r\n\t\t\turl: this.getServiceUrl('pollen_containers'),\r\n\t\t\tdata: oPollenContainersJson,\r\n\t\t\tcontext: this,\r\n\t\t\tasync: true,\r\n\t\t\ttype: 'POST',\r\n\t\t\tcontentType: 'application/json'\r\n\t\t})\r\n\t\t\t.done(this._onDonePutPollenContainers)\r\n\t\t\t.fail(this.onFail.bind(this, 'Maintained Pollen Containers'))\r\n\t}\r\n\r\n\tprivate _onDonePutPollenContainers() {\r\n\t\tthis.applyToFragment('maintainPollenContainers', (o: Dialog) => {\r\n\t\t\to.close();\r\n\t\t}, undefined);\r\n\r\n\t\tthis._load_active_florescences();\r\n\t}\r\n\r\n\tpublic onPressAddPlantForPollenContainer(oEvent: Event) {\r\n\t\tvar iCount = (<StepInput>this.byId('newPlantPollenContainerCount')).getValue();\r\n\t\tif (iCount <= 0) {\r\n\t\t\tMessageToast.show(\"Please enter a positive number\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar oPollenContainer = <ComboBox>this.byId('newPlantPollenContainer');\r\n\t\tif (!oPollenContainer.getSelectedItem()) {\r\n\t\t\tMessageToast.show(\"Please select a plant\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar oPlant = <Plant>oPollenContainer.getSelectedItem()!.getBindingContext('pollenContainersModel')!.getObject();\r\n\t\tvar oNewPollenContainerItem = <NewPollenContainerItem>{\r\n\t\t\tplant_id: oPlant.plant_id,\r\n\t\t\tplant_name: oPlant.plant_name,\r\n\t\t\tgenus: oPlant.genus,\r\n\t\t\tcount_stored_pollen_containers: iCount\r\n\t\t}\r\n\r\n\t\t// insert into pollen containers list\r\n\t\tvar oPollenContainersModel = <JSONModel>this.getView().getModel(\"pollenContainersModel\");\r\n\t\tvar aPollenContainers = oPollenContainersModel.getData().pollenContainerCollection;\r\n\t\taPollenContainers.push(oNewPollenContainerItem);\r\n\r\n\t\t// remove from plants list without pollen containers\r\n\t\tvar aPlantsWithoutPollenContainers = oPollenContainersModel.getData().plantsWithoutPollenContainerCollection;\r\n\t\tvar iIndex = aPlantsWithoutPollenContainers.indexOf(oPlant);\r\n\t\taPlantsWithoutPollenContainers.splice(iIndex, 1);\r\n\r\n\t\toPollenContainersModel.updateBindings(false);\r\n\t\toPollenContainer.clearSelection();\r\n\t}\r\n\r\n\r\n\t////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n\t// \t\tadd active florescences\r\n\t////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n\tpublic onPressAddActiveFlorescence(oEvent: Event) {\r\n\t\t// query plants to fill combobox for new florescence\r\n\t\t$.ajax({\r\n\t\t\turl: this.getServiceUrl('plants_for_new_florescence'),\r\n\t\t\tcontext: this,\r\n\t\t\tasync: true,\r\n\t\t\tcontentType: 'application/json'\r\n\t\t})\r\n\t\t\t.done(this._onDoneGetPlantsForNewFlorescence)\r\n\t\t\t.fail(this.onFail.bind(this, 'Get plants for new florescence'))\r\n\r\n\t\t// create model for new florescence\r\n\t\tvar oNewFlorescence = {\r\n\t\t\tplant_id: undefined,\r\n\t\t\tplant_name: undefined,\r\n\t\t\tflorescence_status: 'inflorescence_appeared',\r\n\t\t\tinflorescence_appearance_date: undefined,\r\n\t\t\tcomment: undefined\r\n\t\t}\r\n\t\t// var oNewFlorescenceModel = new sap.ui.model.json.JSONModel(oNewFlorescence);\r\n\t\tvar oNewFlorescenceModel = new JSONModel(oNewFlorescence);\r\n\t\tthis.getView().setModel(oNewFlorescenceModel, \"newFlorescenceModel\");\r\n\r\n\t\t// open dialog\r\n\t\tvar oView = this.getView();\r\n\t\tif (!this.byId('addActiveFlorescence')) {\r\n\t\t\tFragment.load({\r\n\t\t\t\tname: \"pollination.ui.view.fragments.AddActiveFlorescence\",\r\n\t\t\t\tid: oView.getId(),\r\n\t\t\t\tcontroller: this\r\n\t\t\t}).then((oDialog: any) => {\r\n\t\t\t\toView.addDependent(oDialog);\r\n\t\t\t\toDialog.open();\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\t(<Dialog>this.byId('addActiveFlorescence')).open();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _onDoneGetPlantsForNewFlorescence(result: any) {\r\n\t\tvar oModel = new JSONModel(result.plantsForNewFlorescenceCollection);\r\n\t\toModel.setSizeLimit(2000);\r\n\t\tthis.getView().setModel(oModel, \"plantsForNewFlorescenceModel\");\r\n\t}\r\n\r\n\tpublic onPressSubmitNewFlorescence() {\r\n\t\tvar oNewFlorescenceModel = <JSONModel>this.getView().getModel(\"newFlorescenceModel\");\r\n\t\tvar oNewFlorescence = oNewFlorescenceModel.getData();\r\n\r\n\t\tvar oNewFlorescenceJson = JSON.stringify(oNewFlorescence);\r\n\t\t$.ajax({\r\n\t\t\turl: this.getServiceUrl('active_florescences'),\r\n\t\t\tdata: oNewFlorescenceJson,\r\n\t\t\tcontext: this,\r\n\t\t\tasync: true,\r\n\t\t\ttype: 'POST',\r\n\t\t\tcontentType: 'application/json'\r\n\t\t})\r\n\t\t\t.done(this._onDonePostNewFlorescence)\r\n\t\t\t.fail(this.onFail.bind(this, 'Create new florescence'))\r\n\t}\r\n\r\n\tprivate _onDonePostNewFlorescence() {\r\n\t\tthis.applyToFragment('addActiveFlorescence', (o: Dialog) => {\r\n\t\t\to.close();\r\n\t\t}, undefined);\r\n\r\n\t\tthis._load_active_florescences();\r\n\t}\r\n\r\n\tpublic onAfterCloseAddActiveFlorescence(oEvent: Event) {\r\n\t\tvar oDialog = oEvent.getSource();\r\n\t\toDialog.destroy();\r\n\t\tthis.getView().getModel(\"plantsForNewFlorescenceModel\").destroy();\r\n\t\tthis.getView().getModel(\"newFlorescenceModel\").destroy();\r\n\t}\r\n\r\n\tpublic onPressRetrainProbabilityModelPollinationToSeed(oEvent: Event) {\r\n\t\t$.ajax({\r\n\t\t\turl: this.getServiceUrl('retrain_probability_pollination_to_seed_model'),\r\n\t\t\tcontext: this,\r\n\t\t\tasync: true,\r\n\t\t\ttype: 'POST',\r\n\t\t\tcontentType: 'application/json'\r\n\t\t})\r\n\t\t\t.done(this._onDoneRetrainPollinationModel)\r\n\t\t\t.fail(this.onFail.bind(this, 'Retrain Pollination Model'))\r\n\t}\r\n\r\n\tprivate _onDoneRetrainPollinationModel(result: RetrainPollinationModelResults) {\r\n\t\tvar oSuccessMessageDialog = this._oSuccessMessageDialog;\r\n\t\tif (!this._oSuccessMessageDialog) {\r\n\t\t\tthis._oSuccessMessageDialog = new Dialog({\r\n\t\t\t\ttype: DialogType.Message,\r\n\t\t\t\ttitle: \"Success\",\r\n\t\t\t\tstate: ValueState.Success,\r\n\t\t\t\tcontent: new Text({ text: \"Trained Model: \" + result.model + \"\\n\" + \"Mean F1 Score: \" + result.mean_f1_score }),\r\n\t\t\t\tbeginButton: new Button({\r\n\t\t\t\t\ttype: ButtonType.Emphasized,\r\n\t\t\t\t\ttext: \"OK\",\r\n\t\t\t\t\tpress() {\r\n\t\t\t\t\t\toSuccessMessageDialog.close();\r\n\t\t\t\t\t}  //.bind(this)\r\n\t\t\t\t})\r\n\t\t\t});\r\n\t\t}\r\n\t\tthis._oSuccessMessageDialog.open();\r\n\t}\r\n}"],"mappings":"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"}