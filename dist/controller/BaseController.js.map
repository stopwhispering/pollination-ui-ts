{"version":3,"file":"BaseController.js","names":["Constants","BaseController","Controller","getServiceUrl","sUrl","base_url","applyToFragment","sId","fn","fnInit","sIdToFragment","editFlorescence","editPollination","maintainPollenContainers","addActiveFlorescence","oView","getView","byId","Fragment","load","name","id","getId","controller","then","oFragment","addDependent","onCancelDialog","dialogId","o","close","onChangeInputPreventNonFloat","oEvent","newValue","getParameter","isNaN","Number","sPath","getSource","getBindingPath","oModel","getBindingInfo","binding","getModel","setProperty","undefined","updateBindings","onChangeInputPreventNonInt","isInteger","onSetToday","sModel","sDateField","oData","getData","Date","toISOString","substring","format_timestamp","d","iso","formatted","replace","substr","onFail","trigger","status","responseJSON","detail","message","MessageToast","show"],"sources":["../../src/controller/BaseController.ts"],"sourcesContent":["import Fragment from \"sap/ui/core/Fragment\";\r\nimport Controller from \"sap/ui/core/mvc/Controller\";\r\nimport Event from \"sap/ui/base/Event\";\r\nimport MessageToast from \"sap/m/MessageToast\";\r\nimport Constants from \"../Constants\";\r\n\r\n/**\r\n * @namespace pollination.ui.controller\r\n */\r\nexport default class BaseController extends Controller {\r\n\r\n    public getServiceUrl(sUrl: string) : string {\r\n        return Constants.base_url + sUrl;\r\n    }\r\n\r\n    public applyToFragment(sId: string, fn: Function, fnInit?: Function) : any {\r\n        //create fragment singleton and apply supplied function to it (e.g. open, close)\r\n        // if stuff needs to be done only once, supply fnInit where first usage happens\r\n        \r\n        //example usages:\r\n        // this.applyToFragment('dialogAddTag', _onOpenAddTagDialog.bind(this));\r\n        // this.applyToFragment('dialogFindSpecies', (o)=>o.close());\r\n        // this.applyToFragment('dialogFindSpecies', (o)=>{doA; doB; doC;}, fnMyInit);\r\n        \r\n        //fragment id to fragment file path\r\n        var sIdToFragment = {\r\n            editFlorescence: 'pollination.ui.view.fragments.EditFlorescence',\r\n            editPollination: 'pollination.ui.view.fragments.EditPollination',\r\n            maintainPollenContainers: 'pollination.ui.view.fragments.MaintainPollenContainers',\r\n            addActiveFlorescence: 'pollination.ui.view.fragments.AddActiveFlorescence',\r\n        }\r\n\r\n        var oView = this.getView();\r\n        if(oView.byId(sId)){\r\n            fn(oView.byId(sId));\r\n        } else {\r\n            Fragment.load({\r\n                name: sIdToFragment[sId],\r\n                id: oView.getId(),\r\n                controller: this\r\n            }).then(function(oFragment: Fragment){\r\n                oView.addDependent(oFragment);\r\n                if(fnInit){\r\n                    fnInit(oFragment);\r\n                }\r\n                fn(oFragment);\t\r\n            });\r\n        }\t\t\t\r\n    }\r\n\r\n    public onCancelDialog(dialogId: string) : void {\r\n        // generic handler for fragments to be closed\r\n        this.applyToFragment(dialogId,(o)=>o.close());\r\n    }\r\n\r\n    public onChangeInputPreventNonFloat(oEvent: Event) : void{\r\n        // prevent non-float (i.e. non-numerical) input\r\n        var newValue = oEvent.getParameter('newValue');\r\n        if(isNaN(Number(newValue))){\r\n            var sPath = oEvent.getSource().getBindingPath('value');  // e.g. '/seed_capsule_length'\r\n            var oModel = oEvent.getSource().getBindingInfo('value').binding.getModel();\r\n            oModel.setProperty(sPath, undefined);\r\n            oModel.updateBindings();\r\n        }\r\n    }\r\n\r\n    public onChangeInputPreventNonInt(oEvent: Event) : void{\r\n        // prevent non-integer (i.e. non-numerical or decimal) input\r\n        var newValue = oEvent.getParameter('newValue');\r\n        if(isNaN(Number(newValue)) || !Number.isInteger(Number(newValue))){\r\n            var sPath = oEvent.getSource().getBindingPath('value');  // e.g. '/seed_capsule_length'\r\n            var oModel = oEvent.getSource().getBindingInfo('value').binding.getModel();\r\n            oModel.setProperty(sPath, undefined);\r\n            oModel.updateBindings();\r\n        }\r\n    }\r\n\r\n    public onSetToday(sModel: string, sDateField: string) : any{\r\n        // set today's date in a date field of a model; must be a simple object model, no collection\r\n        var oModel = this.getView().getModel(sModel);\r\n        var oData = oModel.getData();\r\n        oData[sDateField] = (new Date()).toISOString().substring(0,10);  // e.g. '2022-11-17';\r\n        oModel.updateBindings();\r\n    }\r\n\r\n    public format_timestamp(d: Date) : string{\r\n        // convert date object to 'yyyy-MM-dd HH:mm' formatted string\r\n        var iso = d.toISOString();  // '2022-11-15T22:29:30.457Z'\r\n        var formatted = iso.replace('T', ' ').substr(0, 16);  // '2022-11-15 22:29'\r\n        return formatted\r\n    }\r\n\r\n    public onFail(trigger: string, status: any) : any{\r\n        if (!!status && !!status.responseJSON && !!status.responseJSON.detail){\r\n            var message = status.responseJSON.detail.message;\r\n        } else {\r\n            message = 'Error at \"' + trigger + '\" - See console.';\r\n        }\r\n        MessageToast.show(message);\r\n    }    \r\n\r\n}"],"mappings":"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"}